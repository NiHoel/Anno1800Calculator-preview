<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="DuxVitae">
    <title>Anno 1800 Calculator</title>


    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="bootstrap-notify.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js"></script>

    <script type="text/javascript" src="i18n.js"></script>
    <script type="text/javascript" src="AnnoCalculator.js"></script>
    <script type="text/javascript" src="params_2022-10-16-11.js"></script>

    <script id="treeElement" type="text/html">
        <li>
            <shadow href="#" class="tree-node">


                <div class="ui-fchain-item-icon mb-2">
                    <img class="icon-tile" src="" data-bind="attr: { src: $data.factory.icon ? $data.factory.icon : null, alt: $data.factory.name }">
                </div>
                <div class="ui-fchain-item-count mb-2">
                    <div data-bind="if: !$data.residents">
                        <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">
                            <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? formatNumber($data.buildings) : formatNumber(Math.ceil($data.buildings))"></span>
                            <span>x</span>
                        </span>
                    </div>
                    <div data-bind="if: !!$data.residents">
                        <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.residents.name}">
                            <img class="icon-sm icon-light" src="icon_resource_population.png" />
                            <span data-bind="text: formatNumber($data.residents())"></span>
                        </span>
                    </div>
                </div>
                <div class="tree-node-item-name">
                    <a href="#" data-bind="text: $data.factory.name, visible: !$root.settings.hideNames.checked(), click: () => $root.selectedFactory($data.factory)"></a>
                </div>

            </shadow>
            <div data-bind="if: children.length">
                <ul data-bind="template: { name: 'treeElement', foreach: children }">
                </ul>
            </div>
        </li>
    </script>
</head>
<body>
    <noscript>This site requires JavaScript!</noscript>
    <div id="loader" data-bind="visible: false"></div>
    <!-- #params-dialog -->
    <div id="params-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Enter parameters</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <textarea class="form-control" rows="5" id="input-params"></textarea>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /#params-dialog -->
    <!-- #view-mode-dialog -->
    <div id="view-mode-dialog" class="modal" role="dialog" tabindex="-1" aria-hidden="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: texts.viewMode.name">View Mode</h4>
                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" data-bind="text: texts.language.name">Language</span>
                        </div>

                        <select name="language" class="custom-select" id="language" data-bind="value: settings.language, options:settings.languages"></select>
                    </div>

                    <table class="table table-borderless center" data-bind="with: viewMode">
                        <tr>
                            <td>
                                <div data-bind="visible: !hideSimple">
                                    <button data-dismiss="modal" data-bind="click: () => simple()" class="btn btn-primary btn-lg">
                                        <span data-bind="text: $root.texts.viewSimple.name">Simple</span>
                                    </button>
                                </div>
                            </td>
                            <td>
                                <div>
                                    <button data-dismiss="modal" data-bind="click: () => complex()" class="btn btn-primary btn-lg">
                                        <span data-bind="text: $root.texts.viewComplex.name">Complex</span>
                                    </button>
                                </div>
                            </td>
                            <td>
                                <div>
                                    <button data-dismiss="modal" data-bind="click: () => full()" class="btn btn-primary btn-lg">
                                        <span data-bind="text: $root.texts.viewComplete.name">Full</span>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div data-bind="visible: !$data.hideSimple">
                                    <span data-bind="text: $root.texts.viewSimpleDescription.name"></span>
                                </div>
                            </td>
                            <td>
                                <div>
                                    <span data-bind="text: $root.texts.viewComplexDescription.name"></span>
                                </div>
                            </td>
                            <td>
                                <div>
                                    <span data-bind="text: $root.texts.viewCompleteDescription.name"></span>
                                </div>
                            </td>
                        </tr>
                    </table>

                </div>
            </div>
        </div>
    </div>
    <!-- #/view-mode-dialog -->
    <!-- #settings-dialog -->
    <div id="settings-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: texts.settings.name">Settings</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <form>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" data-bind="text: texts.language.name">Language</span>
                            </div>

                            <select name="language" class="custom-select" id="language" data-bind="value: settings.language, options:settings.languages"></select>
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" data-bind="text: texts.selectedIsland.name">Select Island</span>
                            </div>

                            <select name="islands" class="custom-select" id="islands" data-bind="value: view.island, options: view.islands, optionsText: i => i.sessionExtendedName()"></select>
                            <div class="input-group-append">
                                <button class="btn btn-secondary" data-dismiss="modal" data-bind="click: () => setTimeout(() => $('#island-management-dialog').modal(),500)" class="btn btn-light">
                                    <span class="fa fa-cog"> </span>
                                </button>

                            </div>
                        </div>
                        <hr />
                        <table class="table table-striped">
                            <tbody data-bind="foreach: settings.options">
                                <tr data-bind="if: $data.visible()">
                                    <td>
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.id }">
                                            <label class="custom-control-label" data-bind="text: $data.name, attr: { for: $data.id }"></label>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="float-right" data-bind="if: $data.dialog">
                                            <button data-dismiss="modal" data-bind="click: () => setTimeout(() => $('#' + $data.dialog).modal(),500), enable: $data.checked()" class="btn btn-light btn-sm">
                                                <span class="fa fa-cog"> </span>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <hr />
                        <ul class="dlc-list" data-bind="foreach: $root.dlcs">
                            <li class="inline-list" data-bind="css:{inactive: $data.used()}">
                                <img class="icon-sm" src="" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }" style="margin-right: 8px;">
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" data-bind="disable: $data.used(), checked: $data.checked, attr: { id: $data.id }">
                                    <label class="custom-control-label" data-bind="text: $data.name, attr: { for: $data.id }"></label>

                                </div>
                            </li>
                        </ul>
                        <hr />
                        <h6>Server<button type="button" class="help" data-toggle="modal" data-target="#download-dialog">?</button></h6>
                        <div data-bind="foreach: settings.serverOptions">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.id }">
                                <label class="custom-control-label" data-bind="text: $data.name, attr: { for: $data.id }"></label>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- #/settings-dialog -->
    <!-- #help-dialog -->
    <div id="help-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: texts.help.name">Settings</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <h5>Calculator Tutorial</h5>
                    <a class="mb-3" href="https://youtu.be/YxU-8YCzpec" target="_blank">
                        <img class="img-thumbnail img-responsive" src="CalculatorScreenshot.png" />
                    </a>
                    <h5 class="mt-3">Statistics Extraction Tutorial</h5>
                    <a class="mb-3" href="https://youtu.be/k4WmgEIkp4s" target="_blank">
                        <img class="img-thumbnail img-responsive" src="CalculatorExtractionScreenshot.png" />
                    </a>
                    <br />
                    <div class="mt-3" data-bind="html: texts.helpContent.name"></div>

                </div>
            </div>
        </div>
    </div>
    <!-- /#help-dialog -->
    <!-- #factory-choose-dialog -->
    <div id="factory-choose-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: $root.texts.chooseFactories.name">Choose Factory for each Product</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <form>
                        <div data-bind="foreach: $root.selectedMultiFactoryProducts">


                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">
                                        <img class="icon-sm" src="" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">
                                    </span>
                                    <span class="input-group-text" data-bind="text: name"></span>
                                </div>

                                <select class="custom-select" data-bind="value: $data.fixedFactory, options: $data.availableFactories, optionsText: f => f.getRegionExtendedName(), optionsCaption: $root.texts.noFixedFactory.name()"></select>
                            </div>
                        </div>
                        <hr />

                        <div data-bind="foreach: $root.island().replaceInputItems">
                            <div data-bind="visible: $data.visible, css:{'ui-fchain-item-xl': $data.equipments.length > 2}" class="ui-fchain-item ui-fchain-item-small">

                                <div class="ui-fchain-item-tr-checkbox">
                                    <div data-bind="foreach: $data.availableEquipments" style="display:flex">
                                        <span class="custom-control custom-checkbox ml-1">
                                            <input class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $parent.guid + '-' + $data.factory.guid + '-checked' }" type="checkbox">
                                            <label class="custom-control-label" src-only="" data-bind="attr: { for: $parent.guid + '-' + $data.factory.guid + '-checked' }">&#8203;</label>
                                        </span>
                                    </div>
                                </div>

                                <div class="ui-fchain-item-name" style="height: unset">

                                    <span data-bind="text: name"></span>
                                </div>

                                <div class="ui-fchain-item-icon" data-bind="foreach: $data.factories"><img class="icon-tile" src="" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }"></div>


                                <div data-bind="foreach: $data.replacementArray">
                                    <div class="ui-fchain-item-icon-replacement">
                                        <span class="strike-through">
                                            <img src="" data-bind="attr: { src: $data.old.icon ? $data.old.icon : null, alt: $data.old.name }" width="30" height="30">
                                        </span>
                                        <div class="ui-replacement-spacer">
                                            →
                                        </div>
                                        <img src="" data-bind="attr: { src: $data.new.icon ? $data.new.icon : null, alt: $data.new.name }" width="30" height="30">
                                    </div>
                                </div>
                            </div>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- #/factory-choose-dialog -->
    <!-- #download-dialog -->
    <div id="download-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: texts.download.name">Downloads</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <table class="table">
                        <tr>
                            <td data-bind="text: texts.downloadConfig.name"></td>
                            <td>
                                <div class="btn-group float-right">
                                    <label class="btn btn-secondary" id="import-config-button" role="button" href="#" for="config-selector">
                                        <input id="config-selector" type="file" style="display: none;">
                                        <span class="fa fa-upload"> </span>
                                    </label>
                                    <label data-bind="click: () => exportConfig()" id="export-config-button" role="button" href="#" class="btn btn-secondary">
                                        <span class="fa fa-download"> </span>
                                    </label>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td data-bind="text: texts.downloadCalculator.name" style="white-space:pre-wrap"></td>
                            <td>
                                <a id="download-calculator-button" role="button" href="https://github.com/NiHoel/Anno1800Calculator/releases/latest" class="btn btn-secondary float-right">
                                    <span class="fa fa-download"> </span>
                                </a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span data-bind="text: texts.downloadCalculatorServer.name" style="white-space:pre-wrap"></span>
                                <a href="https://github.com/NiHoel/Anno1800UXEnhancer">https://github.com/NiHoel/Anno1800UXEnhancer</a>
                            </td>
                            <td>
                                <a id="download-calculator-server-button" role="button" href="https://github.com/NiHoel/Anno1800UXEnhancer/releases/latest" class="btn btn-secondary float-right">
                                    <span class="fa fa-download"> </span>
                                </a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- /#download-dialog -->
    <!-- #item-equipment-dialog -->
    <div id="item-equipment-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" data-bind="if: !$root.settings.simpleView.checked()">
                <div class="modal-header">
                    <h4 data-bind="text: $root.texts.itemsEquipped.name">Items equipped</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <table class="table">
                        <thead style="text-align: center">
                        <th></th>
                        <th></th>
                        <th data-bind="text: $root.texts.extraGoods.name">Extra Goods</th>
                        <th data-bind="text: $root.texts.productionBuildings.name">Production Buildings</th>
                        <th data-bind="text: $root.texts.all.name">All</th>
                        </thead>
                        <tbody data-bind="foreach: $root.selectedExtraGoodItems">
                            <tr data-bind="visible: $data.visible">
                                <td><img class="icon-sm" src="" data-bind="attr: { src: $data.icon ? $data.icon : null}"></td> <!-- item icon -->
                                <td data-bind="text: $data.name"></td> <!-- item name -->
                                <td>
                                    <span data-bind="foreach: $data.extraGoods" class="inline-list-centered">
                                        <!-- icon extra goods -->
                                        <span style="flex: 100 1 auto;"></span>

                                        <span style="flex: auto;" data-bind="visible: $data.visible()">
                                            <img src="" width="25" height="25" data-bind="attr: { src: $data.icon ? $data.icon  : null, alt: $data.name}" />
                                        </span>

                                        <span style="flex: 100 1 auto;"></span>
                                    </span>
                                </td>
                                <td>
                                    <span data-bind="foreach: $data.availableEquipments" class="inline-list-centered">

                                        <span style="flex-basis: fit-content;">
                                            <span class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.factory.guid + '-' + $data.item.guid + '-equipped' }">
                                                <label class="custom-control-label" data-bind="attr: { for: $data.factory.guid + '-' + $data.item.guid + '-equipped', title: $data.factory.getRegionExtendedName() }" src-only style="vertical-align: top;">
                                                    <span class="mr-2" style="flex-basis: fit-content;">
                                                        <img src="" width="25" height="25" data-bind="attr: { src: $data.factory.icon ? $data.factory.icon  : null, alt: $data.factory.name, for: $data.factory.guid + '-' + $data.item.guid + '-equipped', title: $data.factory.getRegionExtendedName() }" style="margin-right: 0.75em; margin-left: -0.25em;" />
                                                    </span>
                                                </label>
                                            </span>
                                        </span>


                                    </span>
                                </td>

                                <td>
                                    <span>
                                        <span class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.guid + '-check-all' }">
                                            <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-check-all' }" src-only style="vertical-align: top;"> </label>
                                        </span>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
    <!-- #/item-equipment-dialog -->
    <!-- #good-consumption-upgrade-island-dialog -->
    <div id="good-consumption-island-upgrade-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" data-bind="with: $root.selectedGoodConsumptionUpgradeIslandList">
                <div class="modal-header">
                    <h4 data-bind="text: $root.texts.needConsumption.name">Need Consumption</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <h6 data-bind="text: $root.texts.newspaper.name">Newspaper</h6>

                    <form>

                        <div class="form mb-3" data-bind="foreach: $root.newspaperConsumption.allEffects">
                            <span class="custom-control custom-checkbox" data-bind="visible: $data.visible()">
                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.guid + '-checked' }">
                                <label class="custom-control-label" data-bind="text: $data.name() + ' ' + formatPercentage($data.amount), attr: { for: $data.guid + '-checked' }" src-only style="vertical-align: top;"></label>
                            </span>
                        </div>

                        <div class="form-inline" style="justify-content: space-between;">
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" data-bind="text: $root.texts.newspaperEffectiveness.name">Newspaper Effectiveness</span>
                                </div>

                                <select class="custom-select" data-bind="value: $root.newspaperConsumption.selectedBuff, options: $root.newspaperConsumption.selectableBuffs, optionsText: p => formatPercentage(p)"></select>
                            </div>

                            <div class="custom-control">
                                <span data-bind="text: $root.texts.reducedNeeds.name">Reduced Needs</span>
                                <span>: </span>
                                <span data-bind="text: formatPercentage($root.newspaperConsumption.amount())"></span>
                            </div>

                            <button data-dismiss="modal" class="btn btn-light btn-sm" data-bind="visible: !$root.settings.autoApplyConsumptionUpgrades.checked() && $root.islands().length > 1, click: () => $root.newspaperConsumption.apply()">
                                <span data-bind="text: $root.texts.applyGlobally.name">Apply globally</span>
                            </button>
                        </div>
                    </form>
                    <table class="table">
                        <tbody data-bind="foreach: $data.upgrades">
                            <tr data-bind="visible: $data.visible">
                                <td>

                                    <span class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.guid + '-checked' }">
                                        <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-checked' }" src-only style="vertical-align: top;"></label>
                                    </span>
                                </td>
                                <td><img class="icon-sm" src="" data-bind="attr: { src: $data.icon ? $data.icon : null}"></td> <!-- upgrade icon -->
                                <td data-bind="text: $data.name"></td> <!-- upgrade name -->
                                <td>
                                    <span data-bind="foreach: $data.entries" class="inline-list-centered">
                                        <div>
                                            <span data-bind="text: formatPercentage($data.amount)"></span>
                                            <span class="ml-1 mr-2" style="flex-basis: fit-content;" data-bind="if: $data.product">
                                                <img class="icon-sm" src="" data-bind="attr: { src: $data.product.icon ? $data.product.icon  : null, alt: $data.product.name, title: $data.product.name}" style="margin-right: 0.75em; margin-left: -0.25em;" />
                                            </span>
                                        </div>

                                    </span>
                                </td>

                            </tr>
                        </tbody>
                    </table>

                </div>
                <div class="modal-footer" data-bind="visible: !$root.settings.autoApplyConsumptionUpgrades.checked()">
                    <button data-dismiss="modal" class="btn btn-light btn-sm" data-bind="click: () => $data.apply()">
                        <span data-bind="text: $root.texts.apply.name">Apply</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- #/good-consumption-island-upgrade-dialog -->
    <!-- #island-management-dialog -->
    <div id="island-management-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: $root.texts.islands.name">Islands</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" data-bind="text: texts.selectedIsland.name">Select Island</span>
                        </div>

                        <select name="islands" class="custom-select" id="islands" data-bind="value: $root.island, options: $root.islands, optionsText: i => i.sessionExtendedName()"></select>
                        <div class="input-group-append">
                            <button class="btn btn-secondary" data-bind="disable: $root.island().isAllIslands(), click: () => $root.islandManager.startRename($root.island())">
                                <span class="fa fa-pencil"> </span>
                            </button>

                        </div>
                    </div>

                    <hr />

                    <form data-bind="submit: () => $root.islandManager.create($root.islandManager.islandNameInput(), $root.islandManager.sessionInput())">
                        <div class="input-group">
                            <select name="session" class="form-control custom-select" id="session" data-bind="value: $root.islandManager.sessionInput, valueAllowUnset: true, options: $root.islandManager.availableSessions, optionsText: s => s.name()" />


                            <input name="island" class="form-control" id="island" type="text" data-bind="value: $root.islandManager.islandNameInput" />
                            <div class="input-group-append">
                                <button class="btn btn-secondary" data-bind="disable: $root.islandManager.islandExists">
                                    <span class="fa fa-plus"> </span>
                                </button>

                            </div>
                        </div>
                    </form>
                    <div class="custom-control custom-checkbox mb-3">
                        <input id="checkbox-show-island-on-creation" type="checkbox" class="custom-control-input" data-bind="checked: $root.islandManager.showIslandOnCreation.checked">
                        <label class="custom-control-label" for="checkbox-show-island-on-creation" data-bind="text: $root.islandManager.showIslandOnCreation.name"></label>
                    </div>

                    <table class="table table-striped">

                        <tbody data-bind="foreach: $root.islandManager.islandCandidates">
                            <tr>
                                <td>
                                    <span data-bind="click: () => $root.islandManager.deleteCandidate($data)" aria-hidden="true" class="dismiss">×</span>
                                </td>
                                <td>
                                    <div data-bind="if: $data.session">
                                        <img src="" class="icon-sm icon-light" data-bind="attr: {src: $data.session.icon}" />
                                    </div>
                                </td>
                                <td data-bind="text: $data.name"></td>
                                <td>
                                    <span class="float-right">
                                        <button class="btn btn-secondary btn-sm" data-bind="click: () => {$root.islandManager.islandNameInput($data.name), $root.islandManager.sessionInput($data.session)}">
                                            <span class="fa fa-pencil"> </span>
                                        </button>
                                        <button class="btn btn-secondary btn-sm" data-bind="click: () => $root.islandManager.create($data.name, $data.session)">
                                            <span class="fa fa-plus"> </span>
                                        </button>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <hr />
                    <h6 data-bind="text: $root.texts.world.name">The World</h6>
                    <table class="table table-striped table-sm">

                        <tbody data-bind="foreach: $root.islands">
                            <tr>
                                <td>
                                    <div class="inline-list">
                                        <div class="mr-2" data-bind="if: $data.session">
                                            <img src="" class="icon-sm icon-light" data-bind="attr: {src: $data.session.icon}" />
                                        </div>
                                        <a href="#" data-dismiss="modal" data-bind="text: $data.name, click: () => $root.island($data)"></a>
                                    </div>
                                </td>
                                <td>
                                    <div class="inline-list">
                                        <span class="mr-3">
                                            <img class="icon-sm" src="icon_residence.png" data-bind="visible: $root.settings.populationInput() != '0'">
                                            <img class="icon-sm" src="icon_house.png" data-bind="visible: $root.settings.populationInput() == '0'">
                                        </span>
                                        <span data-bind="if: !$data.top2Population().length">0</span>
                                        <!-- ko foreach: $data.top2Population -->
                                        <span class="inline-list">
                                            <span class="ui-tier-unit-icon" class="mr-3">
                                                <img class="icon-sm" src="" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">

                                            </span>
                                            <span class="mr-3" data-bind="text: $root.settings.populationInput() == '0' ? formatNumber($data.existingBuildings()) : ($root.settings.populationInput() == '1' ? formatNumber($data.amount()) : formatNumber($data.limit()))"></span>
                                        </span>
                                        <!-- /ko -->
                                    </div>
                                </td>
                                <td>
                                    <div class="inline-list">
                                        <span class="mr-3">
                                            <img class="icon-sm" src="icon_resource_storage_amount.png">
                                        </span>
                                        <span data-bind="if: !$data.top5Factories().length">0</span>
                                        <!-- ko foreach: $data.top5Factories -->
                                        <span class="inline-list">
                                            <span class="mr-1">
                                                <img class="icon-sm" src="" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">

                                            </span>
                                            <span class="mr-3" data-bind="text: $root.settings.missingBuildingsHighlight.checked() ? $data.existingBuildings() : Math.ceil($data.buildings())"></span>
                                        </span>
                                        <!-- /ko -->
                                    </div>
                                </td>
                                <td>
                                    <div class="float-right" data-bind="if: !$data.isAllIslands()">
                                        <button class="btn btn-secondary btn-sm" data-bind="click: () => $root.islandManager.startRename($data)">
                                            <span class="fa fa-pencil"> </span>
                                        </button>
                                        <button class="btn btn-secondary btn-sm" data-bind="click: () => $root.islandManager.delete($data)">
                                            <span class="fa fa-trash"> </span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" data-bind="text: $root.texts.deleteAll.name, click: factoryReset">Delete All</button>
                </div>
            </div>
        </div>
    </div>
    <!-- #/island-management-dialog -->
    <!-- #island-rename-dialog -->
    <div id="island-rename-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog" data-bind="with: $root.islandManager">
            <div class="modal-content">
                <div class="modal-header" data-bind="with: renameIsland">
                    <img class="icon-light icon-sm mr-2" src="" data-bind="attr: { src: $data.session.icon ? $data.session.icon  : null, alt: $data.session.name, title: $data.session.name}" />
                    <h4 data-bind="text: name">Name</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">

                    <form data-bind="submit: () => {rename(renameIsland(), islandNameInput()); $('#island-rename-dialog').modal('hide');}">
                        <input name="island" class="form-control" id="island" type="text" data-bind="value: $root.islandManager.islandNameInput" />
                    </form>


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal" data-bind="text: $root.texts.confirm.name, enable: !islandExists(), click: () => {rename(renameIsland(), islandNameInput()); $('#island-rename-dialog').modal('hide');}">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <!-- #/island-rename-dialog -->
    <!-- #trade-routes-management-dialog -->
    <div id="trade-routes-management-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 data-bind="text: $root.settings.tradeRoutes.name">Trade Routes</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                </div>
                <div class="modal-body">
                    <table class="table table-striped table-sm" data-bind="if: $root.tradeManager.npcRoutes().length">
                        <tbody class="mb-3" data-bind="foreach: $root.tradeManager.npcRoutes">
                            <tr>
                                <td>
                                    <img class="icon-sm" src="" data-bind="attr: {src: $data.trader.icon, alt: $data.trader.name}" />
                                    <span data-bind="text: $data.trader.name"></span>
                                </td>
                                <td><span>&rarr;</span></td>
                                <td>
                                    <span data-bind="if: $data.to.session">
                                        <img src="" class="icon-sm icon-light" data-bind="attr: {src: $data.to.session.icon}" />
                                    </span>
                                    <a href="#" data-dismiss="modal" data-bind="text: $data.to.name, click: () => {setTimeout(() => { $root.island($data.to); $root.selectedFactory($data.toFactory);$('#factory-config-dialog').modal('show')}, 500);}"></a>
                                </td>
                                <td>
                                    <img class="icon-sm" src="" data-bind="attr: {src: $data.toFactory.product.icon, alt: $data.toFactory.product.name}" />
                                </td>
                                <td>
                                    <span data-bind="text: formatNumber($data.amount)"></span>
                                    <span> t/min</span>
                                </td>
                                <td>
                                    <div class="float-right">
                                        <button class="btn btn-secondary btn-sm" data-bind="click: () => $data.checked(false)">
                                            <span class="fa fa-trash"> </span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <table class="table table-striped table-sm">
                        <tbody data-bind="foreach: $root.tradeManager.routes">
                            <tr>
                                <td>
                                    <span data-bind="if: $data.from.session">
                                        <img src="" class="icon-sm icon-light" data-bind="attr: {src: $data.from.session.icon}" />
                                    </span>
                                    <a href="#" data-dismiss="modal" data-bind="text: $data.from.name, click: () => { $root.island($data.from); setTimeout(() => {$root.selectedFactory($data.fromFactory);$('#factory-config-dialog').modal('show')}, 500);}"></a>
                                </td>
                                <td><span>&rarr;</span></td>
                                <td>
                                    <span data-bind="if: $data.to.session">
                                        <img src="" class="icon-sm icon-light" data-bind="attr: {src: $data.to.session.icon}" />
                                    </span>
                                    <a href="#" data-dismiss="modal" data-bind="text: $data.to.name, click: () => {setTimeout(() => { $root.island($data.to); $root.selectedFactory($data.toFactory);$('#factory-config-dialog').modal('show')}, 500);}"></a>
                                </td>
                                <td>
                                    <img class="icon-sm" src="" data-bind="attr: {src: $data.fromFactory.product.icon, alt: $data.fromFactory.product.name}" />
                                </td>
                                <td>
                                    <div class="float-right">
                                        <span data-bind="if: !$data.isExport($parent) && $root.settings.missingBuildingsHighlight.checked() && $data.fromFactory.overProduction() < -ACCURACY">
                                            <span class="fa fa-exclamation-triangle danger-icon"></span>
                                        </span>
                                        <div class="input-group input-group-short spinner">
                                            <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: amount, attr: { id: $data.from.name().replaceAll(' ', '-') + '-' + $data.to.name().replaceAll(' ', '-') + '-' + $data.toFactory.guid + '-amount-input' }" />
                                            <div class="input-group-append">
                                                <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.amount, id: $data.from.name().replaceAll(' ', '-') + '-' + $data.to.name().replaceAll(' ', '-') + '-' + $data.toFactory.guid + '-amount-input' }}"></div>
                                                <span class="input-group-text">t/min</span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="float-right">
                                        <button class="btn btn-secondary btn-sm" data-bind="click: () => $data.delete()">
                                            <span class="fa fa-trash"> </span>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>
    <!-- #/trade-routes-management-dialog -->
    <!-- navbar -->
    <div id="content" data-bind="visible: true" style="display:none">
        <nav class="navbar navbar-expand-sm bg-dark inline-list-stretched">
            <div class="btn-group">
                <button type="button" class="btn" data-bind="enable: $root.settings.consumptionModifier.checked()">
                    <img data-toggle="modal" data-target="#good-consumption-island-upgrade-dialog" class="icon-navbar" src="icon_newspaper.png" />
                </button>
                <button data-toggle="modal" data-target="#factory-choose-dialog" class="btn text-light">
                    <span class="fa fa-cogs"> </span>
                </button>
                <button type="button" class="btn" data-bind="visible: !$root.settings.simpleView.checked(), enable: $root.settings.additionalProduction.checked()">
                    <img data-toggle="modal" data-target="#item-equipment-dialog" class="icon-navbar" src="icon_add_goods_socket_white.png" />
                </button>
                <button type="button" class="btn" data-bind="enable: $root.dlcsMap.get('dlc7').checked(), visible: $root.island().contractManager">
                    <img data-toggle="modal" data-target="#contract-management-dialog" class="icon-navbar" src="icon_docklands_2d_white.png" />
                </button>
            </div>
            <div class="input-group input-group-sm" data-bind="visible: $root.islands().length > 1" style="width: unset;">


                <select name="islands" class="custom-select" id="islands" data-bind="value: $root.island, options: $root.islands, optionsText: i => i.sessionExtendedName()" style="max-width: 20rem"></select>
                <div class="input-group-append">
                    <button type="button" class="btn">
                        <img data-toggle="modal" data-target="#island-management-dialog" class="icon-navbar" src="icon_map.png" />
                    </button>
                    <button type="button" class="btn" data-bind="enable: $root.settings.tradeRoutes.checked()">
                        <img data-toggle="modal" data-target="#trade-routes-management-dialog" class="icon-navbar" src="icon_shiptrade.png" />
                    </button>
                </div>
            </div>
            <div class="float-right" style="padding-right: 17px;">
                <div class="btn-group float-right">
                    <button data-bind="click: () => $root.darkMode.toggle()" class="btn text-light">
                        <span class="fa fa-adjust"> </span>
                    </button>
                    <button data-toggle="modal" data-target="#settings-dialog" class="btn text-light">
                        <span class="fa fa-cog"> </span>
                    </button>

                    <button data-toggle="modal" data-target="#help-dialog" class="btn text-light">
                        <span class="fa fa-question-circle-o"> </span>
                    </button>
                    <button id="download-selection-button" data-toggle="modal" data-target="#download-dialog" class="btn text-light">
                        <span class="fa fa-download"> </span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- /navbar -->
        <!-- #population-level-config-dialog -->
        <div id="population-level-config-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" data-bind="with: $root.selectedPopulationLevel()">
                    <div class="modal-header">
                        <h4 data-bind="text: $data.name">Population Level</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                    </div>
                    <div class="modal-body">
                        <table class="table table-striped">
                            <tbody>
                                <tr>
                                    <!-- existing buildings -->
                                    <td data-bind="if: !$root.settings.simpleView.checked()">
                                        <input type="radio" name="populationInputSelection" value="0" data-bind="checked: $root.settings.populationInput, attr: {title: $root.texts.useInput.name()}">
                                    </td>
                                    <td>
                                        <span data-bind="text: $root.texts.buildings.name"></span>
                                    </td>
                                    <td>
                                        <div>
                                            <div class="input-group input-group-short spinner">
                                                <input class="form-control" type="number" value="0" step="1" min="0" data-bind="value: existingBuildings, attr: {id: $data.guid + '-existing-buildings-dialog-input'}" />
                                                <div class="input-group-append">
                                                    <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.existingBuildings, id: $data.guid + '-existing-buildings-dialog-input' }}"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-bind="if: !$root.settings.simpleView.checked()">
                                    <!-- amount -->
                                    <td> <input type="radio" name="populationInputSelection" value="1" data-bind="checked: $root.settings.populationInput, attr: {title: $root.texts.useInput.name()}"></td>
                                    <td>
                                        <span data-bind="text: $root.texts.residents.name"></span>
                                    </td>
                                    <td>
                                        <div class="inline-list-stretched">
                                            <div class="input-group spinner" style="max-width: 18rem;">
                                                <div class="input-group-prepend" style="display: flex">
                                                    <div class="input-group-text">
                                                        <div class="mr-2">

                                                            <img class="icon-sm icon-light" src="icon_unlock.png" />
                                                        </div>

                                                        <div class="custom-control custom-switch">
                                                            <input type="checkbox" class="custom-control-input" id="fix-amount-per-house" data-bind="checked: $data.fixAmountPerHouse">
                                                            <label class="custom-control-label" for="fix-amount-per-house">

                                                                <img class="icon-sm icon-light" src="icon_lock.png" />
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <input class="form-control" type="number" value="10" step="1" min="10" data-bind="value: amountPerHouse, disable: $data.fixAmountPerHouse(), attr: {id: $data.guid + '-amountPerHouse-input'}" />
                                                <div class="input-group-append">
                                                    <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.amountPerHouse, id: $data.guid + '-amountPerHouse-input' }}"></div>
                                                    <span class="input-group-text" data-bind="text: $root.texts.perHouse.name">Per House</span>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="input-group input-group-short spinner">
                                                    <input class="form-control" type="number" value="0" step="100" min="0" data-bind="value: amount, attr:{id: $data.guid + '-amount-dialog-input'}" />
                                                    <div class="input-group-append">
                                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.amount, id: $data.guid + '-amount-dialog-input' }}"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </td>
                                </tr>
                                <tr data-bind="if: !$root.settings.simpleView.checked()">
                                    <!-- limit -->
                                    <td> <input type="radio" name="populationInputSelection" value="2" data-bind="checked: $root.settings.populationInput, attr: {title: $root.texts.useInput.name()}"></td>
                                    <td>
                                        <span data-bind="text: $root.texts.maxResidents.name"></span>
                                    </td>
                                    <td>
                                        <div class="inline-list-stretched">
                                            <div class="input-group spinner" style="max-width: 18rem;">
                                                <div class="input-group-prepend" style="display: flex" data-bind="visible: $data.canEditPerHouse">
                                                    <div class="input-group-text">
                                                        <div class="mr-2">

                                                            <img class="icon-sm icon-light" src="icon_unlock.png" />
                                                        </div>

                                                        <div class="custom-control custom-switch">
                                                            <input type="checkbox" class="custom-control-input" id="fix-limit-per-house" data-bind="checked: $data.fixLimitPerHouse">
                                                            <label class="custom-control-label" for="fix-limit-per-house">

                                                                <img class="icon-sm icon-light" src="icon_lock.png" />
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <input class="form-control" type="number" value="10" step="1" min="10" data-bind="value: limitPerHouse, disable: $data.fixLimitPerHouse() || !$data.canEditPerHouse(), attr: {id: $data.guid + '-limitPerHouse-input'}" />
                                                <div class="input-group-append">
                                                    <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.limitPerHouse, id: $data.guid + '-limitPerHouse-input' }}"></div>
                                                    <span class="input-group-text" data-bind="text: $root.texts.perHouse.name">Per House</span>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="input-group input-group-short spinner">
                                                    <input class="form-control" type="number" value="0" step="100" min="0" data-bind="value: limit, attr:{id: $data.guid + '-limit-dialog-input'}" />
                                                    <div class="input-group-append">
                                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.limit, id: $data.guid + '-limit-dialog-input' }}"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </td>
                                </tr>

                            </tbody>
                        </table>

                        <!-- Separate configuration for skyscrapers and houses -->
                        <fieldset class="collapsable-section" data-bind="if: $data.availableResidences().length > 1">
                            <legend class="collapser collapsed" data-toggle="collapse" data-target="#population-level-building-configuration">
                                <span class="fa fa-chevron-right"></span>
                                <span class="fa fa-chevron-down"></span>
                                <span data-bind="text:$data.skyscraperLevels ? $root.texts.skyscrapers.name : $root.texts.residences.name">Skyscrapers</span>
                            </legend>

                            <div id="population-level-building-configuration" class="collapse" data-bind="class: $root.skyscraperDropdownStatus">


                                <div data-bind="visible: $data.skyscraperLevels && $root.settings.simpleView.checked()">
                                    <span class="mb-1" data-bind="text: $root.texts.panoramaEffectNotConsidered.name()">The panorama effect is not considered.</span>
                                    <button type="button" class="help" data-dismiss="modal" data-bind="click: () => {setTimeout(() => { $('#help-dialog').modal('show')}, 500);}">?</button>
                                </div>

                                <table class="table table-striped">
                                    <tbody data-bind="foreach: $data.availableResidences">
                                        <tr>
                                            <td>
                                                <span data-bind="text: $data.name().split(':').slice(-1)[0].trim()"></span>
                                            </td>
                                            <!-- existing buildings -->
                                            <td>

                                                <div class="input-group input-group-short spinner float-left" style="max-width: 8rem;">
                                                    <div class="input-group-prepend">
                                                        <div class="input-group-text">
                                                            <img class="icon-sm icon-light" src="icon_house_white.png" />
                                                        </div>
                                                    </div>
                                                    <input class="form-control" type="number" value="0" step="1" min="0" data-bind="value: existingBuildings, attr: {id: $data.guid + '-existing-buildings-dialog-input'}" />
                                                    <div class="input-group-append">
                                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.existingBuildings, id: $data.guid + '-existing-buildings-dialog-input' }}"></div>
                                                    </div>
                                                </div>


                                                <!--<div data-bind="if: $data.unique && !$data.island.isAllIslands()">
                                                    <div class="custom-control custom-checkbox" data-bind="if: $data.unique && !$data.island.isAllIslands()">
                                                        <input id="checkbox-unique-residence" type="checkbox" class="custom-control-input" data-bind="checked: $data.existingBuildings">
                                                        <label class="custom-control-label" for="checkbox-unique-residence"></label>
                                                    </div>
                                                </div>-->
                                            </td>

                                            <td data-bind="if: !$root.settings.simpleView.checked()">

                                                <div class="input-group spinner" style="max-width: 12rem;">
                                                    <input class="form-control" type="number" value="10" step="1" min="10" data-bind="value: limitPerHouse, attr: {id: $data.guid + '-limitPerHouse-input'}" />
                                                    <div class="input-group-append">
                                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.limitPerHouse, id: $parent.guid + '-limitPerHouse-input' }}"></div>
                                                        <span class="input-group-text" data-bind="text: $root.texts.perHouse.name">Per House</span>
                                                    </div>
                                                </div>
                                            </td>
                                            <td data-bind="if: !$root.settings.simpleView.checked()">

                                                <div class="input-group input-group-medium spinner">
                                                    <div class="input-group-prepend">
                                                        <div class="input-group-text">
                                                            <img class="icon-sm icon-light" src="icon_resource_population.png" />
                                                        </div>
                                                    </div>
                                                    <input class="form-control" type="number" value="0" step="100" min="0" data-bind="value: limit, attr:{id: $data.guid + '-limit-dialog-input'}" />
                                                    <div class="input-group-append">
                                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.limit, id: $data.guid + '-limit-dialog-input' }}"></div>
                                                    </div>
                                                </div>

                                            </td>
                                        </tr>

                                    </tbody>
                                </table>


                                <div class="clear"></div>
                            </div>
                        </fieldset>


                        <div>
                            <table class="table center">
                                <thead>
                                    <tr>
                                        <th data-bind="text: $root.texts.basicNeed.name">Basic Needs</th>
                                        <th data-bind="text: $root.texts.luxuryNeed.name">Luxury Needs</th>
                                        <!-- ko if: $data.hasBonusNeeds() -->
                                        <th data-bind="text: $root.texts.lifestyleNeeds.name">Lifestyle Needs</th>
                                        <!-- /ko -->
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>

                                        <td>

                                            <span data-bind="foreach: $data.basicNeeds" class="inline-list-centered">

                                                <span style="flex-basis: fit-content;" data-bind="hidden: $data.hidden && $data.hidden()">
                                                    <span class="custom-control custom-checkbox" data-bind="css:{inactive: $data.isInactive}">
                                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, disable: $data.isInactive, attr: { id: $parent.guid + '-' + $data.product.guid + '-checked' }">
                                                        <label class="custom-control-label" data-bind="attr: { for: $parent.guid + '-' + $data.product.guid + '-checked', title: $data.product.name() }" src-only style="vertical-align: top;">
                                                            <span class="mr-2" style="flex-basis: fit-content;">
                                                                <img src="" class="icon-sm" data-bind="attr: { src: $data.product.icon ? $data.product.icon  : null, alt: $data.product.name, for: $parent.guid + '-' + $data.product.guid + '-checked', title: $data.product.name() }" style="margin-right: 0.75em; margin-left: -0.25em;" />
                                                            </span>
                                                        </label>
                                                    </span>
                                                </span>


                                            </span>

                                        </td>
                                        <td>
                                            <span data-bind="foreach: $data.luxuryNeeds" class="inline-list-centered">

                                                <span style="flex-basis: fit-content;">
                                                    <span class="custom-control custom-checkbox" data-bind="css:{inactive: $data.isInactive || $root.settings.noOptionalNeeds.checked() }">
                                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, disable: isInactive, attr: { id: $parent.guid + '-' + $data.product.guid + '-checked' }">
                                                        <label class="custom-control-label" data-bind="attr: { for: $parent.guid + '-' + $data.product.guid + '-checked', title: $data.product.name() }" src-only style="vertical-align: top;">
                                                            <span class="mr-2" style="flex-basis: fit-content;">
                                                                <img src="" class="icon-sm" data-bind="attr: { src: $data.product.icon ? $data.product.icon  : null, alt: $data.product.name, for: $parent.guid + '-' + $data.product.guid + '-checked', title: $data.product.name() }" style="margin-right: 0.75em; margin-left: -0.25em;" />
                                                            </span>
                                                        </label>
                                                    </span>
                                                </span>
                                            </span>
                                        </td>

                                        <!-- ko if: $data.hasBonusNeeds() -->
                                        <td>
                                            <span data-bind="foreach: $data.bonusNeeds" class="inline-list-centered">

                                                <span style="flex-basis: fit-content;" data-bind="hidden: $data.hidden()">
                                                    <span class="custom-control custom-checkbox" data-bind="css:{inactive: $data.isInactive}">
                                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, disable: isInactive, attr: { id: $parent.guid + '-' + $data.product.guid + '-checked' }">
                                                        <label class="custom-control-label" data-bind="attr: { for: $parent.guid + '-' + $data.product.guid + '-checked', title: $data.product.name() }" src-only style="vertical-align: top;">
                                                            <span class="mr-2" style="flex-basis: fit-content;">
                                                                <img src="" class="icon-sm" data-bind="attr: { src: $data.product.icon ? $data.product.icon  : null, alt: $data.product.name, for: $parent.guid + '-' + $data.product.guid + '-checked', title: $data.product.name() }" style="margin-right: 0.75em; margin-left: -0.25em;" />
                                                            </span>
                                                        </label>
                                                    </span>
                                                </span>
                                            </span>
                                        </td>
                                        <!-- /ko -->
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="custom-control custom-checkbox" data-bind="visible: !$root.settings.simpleView.checked(), with: $root.settings.deriveResidentsPerHouse">
                                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.id }">
                                                <label class="custom-control-label" data-bind="text: $data.name, attr: { for: $data.id }"></label>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="custom-control custom-checkbox" data-bind="with: $root.settings.noOptionalNeeds">
                                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.id }">
                                                <label class="custom-control-label" data-bind="text: $data.name, attr: { for: $data.id }"></label>
                                            </div>
                                        </td>
                                        <!-- ko if: $data.hasBonusNeeds() -->
                                        <td></td>
                                        <!-- /ko -->
                                    </tr>
                                </tbody>
                            </table>


                        </div>

                        <div data-bind="component: { name: 'notes-section', params:{ $data: $data}}"></div>
                    </div>
                    <div class="modal-footer">
                        <btn class="btn btn-light" data-bind="click: $data.applyConfigGlobally, visible: $root.islands().length > 1">
                            <span data-bind="text: $root.texts.applyGlobally.name()">Apply Globally</span>
                        </btn>
                    </div>
                </div>
            </div>
        </div>
        <!-- #/population-level-config-dialog -->
        <!-- #factory-config-dialog -->
        <div id="factory-config-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content" data-bind="with: $root.selectedFactory()">
                    <div class="modal-header">
                        <h4 data-bind="text: $data.name">Factory Name</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                    </div>
                    <div class="modal-body">
                        <div data-bind="if: $data.availableItems().length && $root.settings.additionalProduction.checked()">
                            <h6 data-bind="text: $root.texts.itemsEquipped.name">Equipped Items</h6>
                            <table class="table table-striped">
                                <tbody data-bind="foreach: $data.availableItems">
                                    <tr>
                                        <td>
                                            <div class="inline-list">
                                                <span class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: 'fc-' + $data.factory.guid + '-' + $data.item.guid + '-equipped' }">
                                                    <label class="custom-control-label" data-bind="attr: { for: 'fc-' + $data.factory.guid + '-' + $data.item.guid + '-equipped', title: $data.factory.getRegionExtendedName() }" src-only style="vertical-align: top;">

                                                    </label>
                                                </span>
                                                <img class="icon-sm" class="mr-2" src="" data-bind="attr: { src: $data.item.icon ? $data.item.icon : null}"><!-- item icon -->
                                                <span data-bind="text: $data.name"></span> <!-- item name -->
                                            </div>
                                        </td>
                                        <td>
                                            <!-- extra goods -->
                                            <span data-bind="if: $data.item.extraGoods">
                                                <span data-bind="foreach: $data.extraGoods" class="inline-list-centered">
                                                    <!-- icon extra goods -->
                                                    <span style="flex: 100 1 auto;"></span>

                                                    <span style="flex: auto;" daba-bind="visible: $data.product.visible()">
                                                        <img class="icon-sm" src="" data-bind="attr: { src: $data.product.icon ? $data.product.icon  : null, alt: $data.product.name}" />
                                                    </span>

                                                    <span style="flex: 100 1 auto;"></span>
                                                </span>
                                            </span>
                                            <!-- input replacements -->
                                            <div data-bind="if: $data.replacementArray">
                                                <div data-bind="foreach: $data.replacementArray">
                                                    <div class="ui-fchain-item-icon-replacement">
                                                        <span class="strike-through">
                                                            <img src="" data-bind="attr: { src: $data.old.icon ? $data.old.icon : null, alt: $data.old.name }" width="30" height="30">
                                                        </span>
                                                        <div class="ui-replacement-spacer">
                                                            →
                                                        </div>
                                                        <img src="" data-bind="attr: { src: $data.new.icon ? $data.new.icon : null, alt: $data.new.name }" width="30" height="30">
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- workforce replacement -->
                                            <div data-bind="if: $data.replacingWorkforce && ($parent.workforceDemand instanceof WorkforceDemandSwitch)">
                                                <div class="ui-fchain-item-icon-replacement">
                                                    <span class="strike-through">
                                                        <img src="" data-bind="attr: { src: $parent.workforceDemand.defaultWorkforce.icon ? $parent.workforceDemand.defaultWorkforce.icon : null, alt: $parent.workforceDemand.defaultWorkforce.name }" width="30" height="30">
                                                    </span>
                                                    <div class="ui-replacement-spacer">
                                                        →
                                                    </div>
                                                    <img src="" data-bind="attr: { src: $parent.workforceDemand.replacingWorkforce.icon ? $parent.workforceDemand.replacingWorkforce.icon : null, alt: $parent.workforceDemand.replacingWorkforce.name }" width="30" height="30">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <hr />
                        </div>

                        <div data-bind="if: $root.settings.tradeRoutes.checked() && $data instanceof Factory">
                            <div data-bind="with: $data.tradeList">

                                <h6><span data-bind="text: $root.settings.tradeRoutes.name">Trade Routes</span></h6>

                                <div class="mb-3 inline-list-stretched" data-bind="foreach: $data.npcRoutes">
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.trader.guid + '-npcRoute-checked' }">
                                        <label class="custom-control-label" data-bind="attr: { for: $data.trader.guid + '-npcRoute-checked' }" src-only style="vertical-align: top;">
                                            <img class="icon-sm" src="" data-bind="attr:{src: $data.trader.icon}" />
                                            <span data-bind="text: $data.trader.name"></span>
                                        </label>
                                    </div>

                                    <div>
                                        <span data-bind="text: formatNumber($data.amount)"></span>
                                        <span> t/min</span>
                                    </div>
                                </div>

                                <table class="table table-striped table-sm" data-bind="if: !$data.island.isAllIslands()">
                                    <tbody data-bind="foreach: $data.routes">
                                        <tr>
                                            <td>
                                                <span data-bind="if: $data.getOpposite($parent).session">
                                                    <img src="" class="icon-sm icon-light" data-bind="attr: {src: $data.getOpposite($parent).session.icon}" />
                                                </span>
                                                <a href="#" data-bind="text: $data.getOpposite($parent).name, click: () => {$root.selectedFactory($data.getOppositeFactory($parent.factory)); $root.island($data.getOpposite($parent))}"></a>
                                            </td> <!-- island name -->
                                            <!-- factory summary -->
                                            <!--<td data-bind="with: $data.getOpposite($parent)">
                                                <div style="display: flex; flex-flow: wrap; justify-content: center">
                                                    <span class="mr-3">
                                                        <img src="icon_resource_storage_amount.png" width="25" height="25">
                                                    </span>
                                                    <span data-bind="if: !$data.top5Factories().length">0</span>
                                                    <span data-bind="foreach: $data.top5Factories" style="display: flex; flex-flow: wrap; justify-content: center">
                                                        <span class="mr-1">
                                                            <img src="" width="25" height="25" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">

                                                        </span>
                                                        <span class="mr-3" data-bind="text: $root.settings.missingBuildingsHighlight.checked() ? $data.existingBuildings() : Math.ceil($data.buildings())"></span>
                                                    </span>
                                                </div>
                                            </td> -->

                                            <td>
                                                <div data-bind="if: $data.isExport($parent) && $parent.factory.overProduction() > ACCURACY">
                                                    <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.exportOverproduction.name}">
                                                        <span data-bind="text: formatNumber($parent.factory.overProduction())"></span>
                                                        <button class="btn btn-light btn-sm" data-bind="click: () => $data.amount($data.amount() + $parent.factory.overProduction())">
                                                            <span class="fa fa-sign-in"> </span>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div data-bind="if: !$data.isExport($parent) && $parent.factory.overProduction() < -ACCURACY">
                                                    <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.importDeficit.name}">
                                                        <span data-bind="text: formatNumber(-$parent.factory.overProduction())"></span>
                                                        <button class="btn btn-light btn-sm" data-bind="click: () => $data.amount($data.amount() - $parent.factory.overProduction())">
                                                            <span class="fa fa-sign-in"> </span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>

                                                <div class="input-group spinner" style="max-width: 12rem">
                                                    <div class="input-group-prepend">
                                                        <div class="input-group-text">
                                                            <span data-bind="if: $data.isExport($parent)">

                                                                <img class="icon-sm icon-light" src="icon_transporter_unloading_light.png" />
                                                            </span>
                                                            <span data-bind="if: !$data.isExport($parent)">

                                                                <img class="icon-sm icon-light" src="icon_transporter_loading_light.png" />
                                                            </span>
                                                        </div>
                                                        <span data-bind="if: !$data.isExport($parent) && $root.settings.missingBuildingsHighlight.checked() && $data.fromFactory.overProduction() < -ACCURACY">
                                                            <span class="fa fa-exclamation-triangle danger-icon"></span>
                                                        </span>
                                                    </div>
                                                    <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: amount, attr: {id: $data.guid + '-amount-input' } " />
                                                    <div class="input-group-append">
                                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.amount, id: $data.guid + '-amount-input' }}"></div>
                                                        <span class="input-group-text">t/min</span>
                                                    </div>
                                                </div>

                                            </td>
                                            <td>

                                                <button class="btn btn-secondary btn-sm float-right" data-bind="click: () => $data.delete()">
                                                    <span class="fa fa-trash"> </span>
                                                </button>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <form class="form form-inline" data-bind="if: $data.unusedIslands().length && !$data.island.isAllIslands() " style="justify-content: space-between">

                                    <select name="islands" class="custom-select" id="islands" data-bind="value: $data.selectedIsland, options: $data.unusedIslands, optionsText: i => i.sessionExtendedName() /* + '\t' + i.assetsMap.get($data.factory.guid).overProduction() + ' t/min' */"></select>
                                    <div style="display: flex">
                                        <div class="mr-2">

                                            <img class="icon-sm icon-light" src="icon_transporter_loading_light.png" />
                                        </div>
                                        <div class="custom-control custom-switch">
                                            <input type="checkbox" class="custom-control-input" id="create-trade-route-export-checkbox" data-bind="checked: $data.export">
                                            <label class="custom-control-label" for="create-trade-route-export-checkbox">

                                                <img class="icon-sm icon-light" src="icon_transporter_unloading_light.png" />
                                            </label>
                                        </div>
                                    </div>
                                    <div class="input-group input-group-short spinner">

                                        <input step="0.1" class="form-control" type="number" value="0" data-bind="value: newAmount" />
                                        <div class="input-group-append">
                                            <span class="input-group-text">t/min</span>
                                        </div>
                                    </div>
                                    <button class="btn btn-sm btn-light" data-bind="click: () => $data.create(), enable: $data.canCreate()">
                                        <span class="fa fa-plus"></span>
                                    </button>
                                </form>
                            </div>
                            <hr />
                        </div>

                        <div data-bind="if:  $root.dlcsMap.get('dlc7').checked() && $data instanceof Factory && $data.getProduct().exchangeWeight">
                            <div data-bind="with: $data.contractList">

                                <h6><span data-bind="text: $root.texts.docklands.name">Trade Contracts</span></h6>


                                <div data-bind="if: $data.exports().length || $data.imports().length">
                                    <table class="table table-striped table-sm">
                                        <tbody>
                                            <!-- export contracts -->
                                            <!-- ko foreach: $data.exports -->
                                            <tr>
                                                <td>
                                                    <div class="input-group spinner input-transfer-amount">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text">
                                                                <img class="icon-sm icon-light" src="icon_transporter_loading_light.png" />

                                                                <a href="#" data-bind="click: () => {$root.selectedFactory($data.importFactory)}, attr: {title: $data.importFactory.name()}" style="margin: 0 0.25rem;">
                                                                    <img class="icon-sm" src="" data-bind="attr: { src: $data.importFactory.icon ? $data.importFactory.icon : null, alt: $data.importFactory.name}">
                                                                </a>
                                                            </span>
                                                        </div>
                                                        <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: importAmount, attr: {id: $data.importFactory.guid + '-export-contract-import-amount-input' } " />
                                                        <div class="input-group-append">
                                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.importAmount, id: $data.importFactory.guid + '-export-contract-import-amount-input' }}"></div>
                                                            <span class="input-group-text">t/min</span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td><span>&larr;</span></td>
                                                <td>
                                                    <div class="float-right" data-bind="if: $parent.factory.overProduction() > ACCURACY">
                                                        <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.exportOverproduction.name}">
                                                            <span data-bind="text: formatNumber($parent.factory.overProduction())"></span>
                                                            <button class="btn btn-light btn-sm" data-bind="click: () => $data.exportAmount($data.exportAmount() + $parent.factory.overProduction())">
                                                                <span class="fa fa-sign-in"> </span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>

                                                    <div class="input-group spinner float-right input-transfer-amount">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text">
                                                                <img class="icon-sm icon-light" src="icon_transporter_unloading_light.png" />
                                                                <img class="icon-sm" src="" data-bind="attr: { src: $data.exportFactory.icon ? $data.exportFactory.icon : null, alt: $data.exportFactory.name}" style="margin: 0 0.25rem;">

                                                            </span>
                                                        </div>
                                                        <span data-bind="if: $root.settings.missingBuildingsHighlight.checked() && $data.exportFactory.overProduction() < -ACCURACY">
                                                            <span class="fa fa-exclamation-triangle danger-icon"></span>
                                                        </span>
                                                        <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: exportAmount, attr: {id: $data.importFactory.guid + '-export-contract-export-amount-input' } " />
                                                        <div class="input-group-append">
                                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.exportAmount, id: $data.importFactory.guid + '-export-contract-export-amount-input' }}"></div>
                                                            <span class="input-group-text">t/min</span>
                                                        </div>
                                                    </div>

                                                </td>
                                                <td>

                                                    <button class="btn btn-secondary btn-sm float-right" data-bind="click: () => $data.delete()">
                                                        <span class="fa fa-trash"> </span>
                                                    </button>

                                                </td>
                                            </tr>
                                            <!-- /ko -->
                                            <!-- import contracts -->
                                            <!-- ko foreach: $data.imports -->
                                            <tr>
                                                <td>
                                                    <div class="input-group spinner input-transfer-amount">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text">
                                                                <img class="icon-sm icon-light" src="icon_transporter_unloading_light.png" />
                                                                <a href="#" data-bind="click: () => {$root.selectedFactory($data.exportFactory)}, attr: {title: $data.exportFactory.name()}" style="margin: 0 0.25rem;">
                                                                    <img class="icon-sm" src="" data-bind="attr: { src: $data.exportFactory.icon ? $data.exportFactory.icon : null, alt: $data.exportFactory.name}">
                                                                </a>
                                                            </span>
                                                            <span data-bind="if: $root.settings.missingBuildingsHighlight.checked() && $data.exportFactory.overProduction() < -ACCURACY">
                                                                <span class="fa fa-exclamation-triangle danger-icon"></span>
                                                            </span>
                                                        </div>
                                                        <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: exportAmount, attr: {id: $data.exportFactory.guid + '-import-contract-export-amount-input' } " />
                                                        <div class="input-group-append">
                                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.exportAmount, id: $data.exportFactory.guid + '-import-contract-export-amount-input' }}"></div>
                                                            <span class="input-group-text">t/min</span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td><span>&rarr;</span></td>
                                                <td>
                                                    <div class="float-right" data-bind="if: $parent.factory.overProduction() < -ACCURACY">
                                                        <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.importDeficit.name}">
                                                            <span data-bind="text: formatNumber($parent.factory.overProduction())"></span>
                                                            <button class="btn btn-light btn-sm" data-bind="click: () => $data.importAmount($data.importAmount() - $parent.factory.overProduction())">
                                                                <span class="fa fa-sign-in"> </span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>

                                                    <div class="input-group spinner float-right input-transfer-amount">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text">
                                                                <img class="icon-sm icon-light" src="icon_transporter_loading_light.png" />
                                                                <img class="icon-sm" src="" data-bind="attr: { src: $data.importFactory.icon ? $data.importFactory.icon : null, alt: $data.importFactory.name}" style="margin: 0 0.25rem;">
                                                            </span>
                                                        </div>
                                                        <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: importAmount, attr: {id: $data.exportFactory.guid + '-import-contract-import-amount-input' } " />
                                                        <div class="input-group-append">
                                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.importAmount, id: $data.exportFactory.guid + '-import-contract-import-amount-input' }}"></div>
                                                            <span class="input-group-text">t/min</span>
                                                        </div>
                                                    </div>

                                                </td>
                                                <td>

                                                    <button class="btn btn-secondary btn-sm float-right" data-bind="click: () => $data.delete()">
                                                        <span class="fa fa-trash"> </span>
                                                    </button>

                                                </td>
                                            </tr>
                                            <!-- /ko -->
                                        </tbody>
                                    </table>
                                </div>

                                <!-- create new contracts -->
                                <form class="form form-inline" style="justify-content: space-between" data-bind="with: $root.contractCreatorFactory, visible: $root.contractCreatorFactory.canImport() || $root.contractCreatorFactory.canExport()">

                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">
                                                <img class="icon-sm icon-light" src="icon_transporter_unloading_light.png" data-bind="visible: !$data.export()" />
                                                <img class="icon-sm icon-light" src="icon_transporter_loading_light.png" data-bind="visible: $data.export()" />
                                            </span>
                                        </div>
                                        <select name="products" class="custom-select" id="contract-product" data-bind="value: $data.exchangeProduct, options: $data.exchangeProducts, optionsText: i => i.name()"></select>
                                        <select name="factories" class="custom-select" id="contract-factory" data-bind="value: $data.exchangeFactory, options: $data.exchangeFactories, optionsText: i => i.getRegionExtendedName(), visible: $data.exchangeFactories().length > 1"></select>
                                    </div>


                                    <div>
                                        <span data-bind="visible: $data.export()">&larr;</span>
                                        <span data-bind="visible: !$data.export()">&rarr;</span>
                                    </div>
                                    <div style="display: flex">

                                        <div class="mr-2" data-bind="visible: $data.canImport()">

                                            <img class="icon-sm icon-light" src="icon_transporter_loading_light.png" />
                                        </div>

                                        <div class="custom-control custom-switch" data-bind="visible: $data.canImport() && $data.canExport()">
                                            <input type="checkbox" class="custom-control-input" id="create-contract-export-checkbox" data-bind="checked: $data.export">
                                            <label class="custom-control-label" for="create-contract-export-checkbox" data-bind="visible: $data.canExport()">

                                                <img class="icon-sm icon-light" src="icon_transporter_unloading_light.png" />
                                            </label>
                                        </div>

                                        <div class="mr-2" data-bind="visible: !$data.canImport() && $data.canExport()">

                                            <img class="icon-sm icon-light" src="icon_transporter_unloading_light.png" />
                                        </div>
                                    </div>
                                    <div class="input-group input-group-short spinner input-transfer-amount">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">
                                                <img class="icon-sm" src="" data-bind="attr: { src: $root.selectedFactory().icon ? $root.selectedFactory().icon : null, alt:$root.selectedFactory().name}" style="margin: 0 0.25rem;">
                                            </span>
                                        </div>
                                        <input step="0.1" class="form-control" type="number" value="0" data-bind="value: newAmount, attr: {id: 'factory-new-contract-amount-input' }" />
                                        <div class="input-group-append">
                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.newAmount, id: 'factory-new-contract-amount-input' }}"></div>
                                            <span class="input-group-text">t/min</span>
                                        </div>
                                    </div>

                                    <button class="btn btn-sm btn-light" data-bind="click: () => $data.create(), enable: $data.canCreate()">
                                        <span class="fa fa-plus"></span>
                                    </button>
                                </form>

                                <hr />
                            </div>
                        </div>

                        <div data-bind="if: !$root.settings.simpleView.checked() && $data instanceof Factory && ($root.settings.additionalProduction.checked() || $root.settings.tradeRoutes.checked() || $data.contractList && $root.dlcsMap.get('dlc7').checked())">
                            <div class="inline-list-stretched" style="padding: .75rem;">
                                <div data-bind="if: $root.settings.tradeRoutes.checked()">
                                    <span class="mr-3" data-bind="text: $root.settings.tradeRoutes.name"></span>
                                    <span data-bind="text: formatNumber(-$data.tradeList.amount())"></span>
                                    <span class="mr-3"> t/min</span>
                                </div>
                                <div data-bind="if: $data.contractList && $root.dlcsMap.get('dlc7').checked()">
                                    <span class="mr-3" data-bind="text: $root.texts.docklands.name"></span>
                                    <span data-bind="text: formatNumber(-$data.contractList.amount())"></span>
                                    <span class="mr-3"> t/min</span>
                                </div>
                                <div data-bind="if: $root.settings.additionalProduction.checked()">
                                    <span class="custom-control custom-checkbox" style="display:unset">
                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.extraGoodProductionList.checked, attr: { id: $data.guid + '-extraGoodProductionList-checked' }">
                                        <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-extraGoodProductionList-checked' }, text: $root.texts.extraGoods.name" src-only style="vertical-align: top;">

                                        </label>
                                    </span>
                                    <span data-bind="text: formatNumber($data.extraGoodProductionList.amountWithSelf())"></span>
                                    <span class="mr-3"> t/min</span>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-light" data-bind="click: () => $data.updateExtraGoods(1), enable: $data.amount() || $data.extraGoodProductionList.amount() || $data.tradeList.amount() || $data.contractList && $data.contractList.amount()">
                                        <span data-bind="text: $root.texts.apply.name">Apply</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <table class="table table-striped">
                            <tbody>
                                <tr data-bind="if: !$root.settings.simpleView.checked() && $data instanceof Factory && ($root.settings.additionalProduction.checked() || $root.settings.tradeRoutes.checked() || $data.contractList && $root.dlcsMap.get('dlc7').checked())">
                                    <!-- extra goods -->
                                    <td>
                                        <span data-bind="text: $root.texts.extraNeed.name"></span>
                                    </td>
                                    <td>


                                        <div class="float-right">
                                            <span data-bind="if: $data.extraAmount() < -ACCURACY + $data.computedExtraAmount()">
                                                <span class="fa fa-exclamation-triangle danger-icon"></span>
                                            </span>
                                            <div class="input-group input-group-short spinner">
                                                <input step="0.1" class="form-control" type="number" value="0" data-bind="value: extraAmount, attr: {id: $data.guid + '-extraAmount-input'} " />
                                                <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.extraAmount, id: $data.guid + '-extraAmount-input' }}"></div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-bind="if: $data.percentBoost">
                                    <!-- boost -->
                                    <td>
                                        <span data-bind="text: $root.texts.productionBoost.name"></span>
                                    </td>
                                    <td>
                                        <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.productionBoost.name}">
                                            <div class="input-group input-group-short spinner">
                                                <input class="form-control" type="number" value="100" step="1" min="1" data-bind="value: percentBoost, attr: {id: $data.guid + '-percentBoost-input'}" />
                                                <div class="input-group-append">
                                                    <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.percentBoost, id: $data.guid + '-percentBoost-input' }}"></div>
                                                    <span class="input-group-text">%</span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-bind="with: $data.workforceDemand">
                                    <!-- workforce -->
                                    <td>
                                        <span data-bind="text: $root.texts.workforce.name"></span>
                                    </td>
                                    <td>
                                        <div class="inline-list-stretched">
                                            <div class="input-group input-group-short spinner">
                                                <input class="form-control" type="number" value="100" step="10" min="0" data-bind="value: percentBoost, attr: {id: $parent.guid + '-workforcePercentBoost-input'}" />
                                                <div class="input-group-append">
                                                    <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.percentBoost, id: $parent.guid + '-workforcePercentBoost-input' }}"></div>
                                                    <span class="input-group-text">%</span>
                                                </div>
                                            </div>
                                            <div>

                                                <span data-bind="text: formatNumber($data.amount())"></span>
                                                <img class="mr-2 icon-sm" src="" data-bind="attr: { src: $data.workforce().icon ? $data.workforce().icon : null, alt: $data.workforce().name}">
                                            </div>
                                        </div>

                                    </td>
                                </tr>
                                <tr data-bind="if: $data.editable() || $root.settings.missingBuildingsHighlight.checked() && (!$data.region || !$data.island.region || $data.region === $data.island.region) ">
                                    <!-- existing buildings -->
                                    <td>
                                        <span data-bind="text: $root.texts.existingNumberOfBuildings.name"></span>
                                    </td>
                                    <td>
                                        <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.existingNumberOfBuildings.name}">
                                            <div class="input-group input-group-short spinner">
                                                <input class="form-control" type="number" value="0" step="1" min="0" data-bind="value: existingBuildings, attr:{id: $data.guid + '-existingBuildings-input'}" />
                                                <div class="input-group-append">
                                                    <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.existingBuildings, id: $data.guid + '-existingBuildings-input' }}"></div>
                                                </div>
                                            </div>
                                        </div>

                                    </td>
                                </tr>

                                <tr data-bind="if: $root.settings.missingBuildingsHighlight.checked() && $data.overProduction">
                                    <!-- overproduction -->
                                    <td>
                                        <span data-bind="text: $root.texts.overproduction.name"></span>
                                    </td>
                                    <td>
                                        <div class="float-right">
                                            <span data-bind="text: formatNumber($data.overProduction())"></span><span> t/min</span>
                                        </div>
                                    </td>
                                </tr>

                                <tr data-bind="if: $data.palaceBuff && $data.palaceBuffChecked()">
                                    <!-- extra goods palace -->
                                    <td>
                                        <span data-bind="text: $root.texts.extraGoods.name"></span>
                                        <span>: </span>
                                        <span data-bind="text: $data.palaceBuff.name"></span>
                                    </td>
                                    <td>
                                        <div class="float-right">
                                            <img class="mr-2 icon-sm" src="" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name}">
                                            <span data-bind="text: formatNumber($data.buffAmount())"></span><span> t/min</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-bind="if: $data.module && $data.moduleChecked()">
                                    <!-- extra goods module -->
                                    <td>
                                        <span data-bind="text: $root.texts.extraGoods.name"></span>
                                        <span>: </span>
                                        <span data-bind="text: $data.module.name"></span>
                                    </td>
                                    <td>
                                        <div class="float-right">
                                            <img class="mr-2 icon-sm" src="" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name}">
                                            <span data-bind="text: formatNumber($data.outputAmount() / $data.module.additionalOutputCycle)"></span><span> t/min</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-bind="if: $data.module && $data.moduleChecked()">
                                    <!-- consumption module -->
                                    <td>
                                        <span data-bind="text: $root.texts.consumption.name"></span>
                                        <span>: </span>
                                        <span data-bind="text: $data.module.name"></span>
                                    </td>
                                    <td>
                                        <div class="float-right">
                                            <img class="mr-2 icon-sm" src="" data-bind="attr: { src: $data.moduleDemand.product.icon ? $data.moduleDemand.product.icon : null, alt: $data.moduleDemand.product.name}">
                                            <span data-bind="text: formatNumber($data.moduleDemand.amount())"></span><span> t/min</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-bind="if: $data.fertilizerModule && $data.fertilizerModuleChecked()">
                                    <!-- extra goods fertilizer fertilizerModule -->
                                    <td>
                                        <span data-bind="text: $root.texts.extraGoods.name"></span>
                                        <span>: </span>
                                        <span data-bind="text: $data.fertilizerModule.name"></span>
                                    </td>
                                    <td>
                                        <div class="float-right">
                                            <img class="mr-2 icon-sm" src="" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name}">
                                            <span data-bind="text: formatNumber($data.outputAmount() / $data.fertilizerModule.additionalOutputCycle)"></span><span> t/min</span>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-bind="if: $data.fertilizerModule && $data.fertilizerModuleChecked()">
                                    <!-- consumption fertilizerModule -->
                                    <td>
                                        <span data-bind="text: $root.texts.consumption.name"></span>
                                        <span>: </span>
                                        <span data-bind="text: $data.fertilizerModule.name"></span>
                                    </td>
                                    <td>
                                        <div class="float-right">
                                            <img class="mr-2 icon-sm" src="" data-bind="attr: { src: $data.fertilizerModuleDemand.product.icon ? $data.fertilizerModuleDemand.product.icon : null, alt: $data.fertilizerModuleDemand.product.name}">
                                            <span data-bind="text: formatNumber($data.fertilizerModuleDemand.amount())"></span><span> t/min</span>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="ui-fchain-item-module" data-bind="visible: !$root.settings.simpleView.checked() && (!!$data.module || !!$data.palaceBuff || !!$data.clipped)">
                            <div style="flex: 100 1 auto;"></div>

                            <!-- module -->
                            <div data-bind="if: !!$data.module && $data.module.visible()" style="flex: auto;">
                                <div class="custom-control custom-checkbox" data-bind="visible: !!$data.module">
                                    <input type="checkbox" class="custom-control-input" data-bind="checked: $data.moduleChecked, attr: { id: $data.guid + '-module' }">
                                    <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-module', title: $data.module.name }" src-only style="vertical-align: top;">

                                    </label>
                                </div>
                            </div>
                            <div data-bind="if: !!$data.module && $data.module.visible()" style="flex: auto;">
                                <img class="icon-sm" src="" data-bind="attr: { src: $data.module.icon ? $data.module.icon  : null, alt: $data.module.name, for: $data.guid + '-module', title: $data.module.name }" style="margin-right: 0.75em;margin-left: -0.25em;" />
                            </div>

                            <!-- fertilizerModule -->
                            <div data-bind="if: !!$data.fertilizerModule && $data.fertilizerModule.visible()" style="flex: auto;">
                                <div class="custom-control custom-checkbox" data-bind="visible: !!$data.fertilizerModule">
                                    <input type="checkbox" class="custom-control-input" data-bind="checked: $data.fertilizerModuleChecked, attr: { id: $data.guid + '-fertilizerModule' }">
                                    <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-fertilizerModule', title: $data.fertilizerModule.name }" src-only style="vertical-align: top;">

                                    </label>
                                </div>
                            </div>
                            <div data-bind="if: !!$data.fertilizerModule && $data.fertilizerModule.visible()" style="flex: auto;">
                                <img class="icon-sm" src="" data-bind="attr: { src: $data.fertilizerModule.icon ? $data.fertilizerModule.icon  : null, alt: $data.fertilizerModule.name, for: $data.guid + '-fertilizerModule', title: $data.fertilizerModule.name }" style="margin-right: 0.75em;margin-left: -0.25em;" />
                            </div>

                            <!-- palace buff -->
                            <div data-bind="if: !!$data.palaceBuff && $data.palaceBuff.visible()" style="flex: auto;">
                                <div class="custom-control custom-checkbox" data-bind="visible: !!$data.palaceBuff">
                                    <input type="checkbox" class="custom-control-input" data-bind="checked: $data.palaceBuffChecked, attr: { id: $data.guid + '-palaceBuff' }">
                                    <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-palaceBuff', title: $data.palaceBuff.name }" src-only style="vertical-align: top;">

                                    </label>
                                </div>
                            </div>
                            <div data-bind="if: !!$data.palaceBuff && $data.palaceBuff.visible()" style="flex: auto;">
                                <img class="icon-sm" src="" data-bind="attr: { src: $data.palaceBuff.icon ? $data.palaceBuff.icon  : null, alt: $data.palaceBuff.name, for: $data.guid + '-palaceBuff', title: $data.palaceBuff.name }" style="margin-right: 0.75em;margin-left: -0.25em;" />
                            </div>

                            <!-- clipping  -->
                            <div data-bind="if: !!$data.clipped" style="flex: auto;">
                                <div class="custom-control custom-checkbox" data-bind="visible: !!$data.clipped">
                                    <input type="checkbox" class="custom-control-input" data-bind="checked: $data.clipped, attr: { id: $data.guid + '-clipped' }">
                                    <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-clipped', title: 'Clipping' }" src-only style="vertical-align: top;">
                                        Clipping
                                    </label>
                                </div>
                            </div>
                            <div style="flex: 100 1 auto;"></div>
                        </div>

                        <div data-bind="if: $data instanceof Factory && ($data.extraGoodProductionList.nonZero().length && $root.settings.additionalProduction.checked())">
                            <hr />

                            <h6><span data-bind="text: $root.texts.extraGoods.name">Extra Goods</span><span> </span><img src="" width="35" height="35" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name}" /></h6>
                            <table class="table table-striped">
                                <tbody data-bind="foreach: $data.extraGoodProductionList.nonZero">
                                    <tr>

                                        <td>

                                            <img class="icon-sm" src="" data-bind="attr: { src: $data.item.item.icon ? $data.item.item.icon : null, alt: $data.item.name}"> <!-- item icon -->
                                            <img class="icon-sm" src="" data-bind="attr: { src: $data.factory.icon ? $data.factory.icon : null, alt: $data.factory.name}">

                                        </td> <!-- factory icon -->
                                        <td>
                                            <span data-bind="text: formatNumber($data.amount())"></span>
                                            <span> t/min</span>

                                        </td>

                                    </tr>
                                </tbody>
                            </table>


                        </div>
                        <div data-bind="if: $root.productionChain.tree() && $root.productionChain.tree().buildings > ACCURACY">
                            <hr />
                            <div class="tree" data-bind="with: $root.productionChain.tree()" style="justify-content: center">
                                <ul data-bind="template: { name: 'treeElement'}"></ul>
                            </div>
                        </div>

                        <div data-bind="component: { name: 'notes-section', params:{ $data: $data}}"></div>
                    </div>
                    <div class="modal-footer">
                        <btn class="btn btn-light" data-bind="click: $data.applyConfigGlobally, visible: $root.islands().length > 1">
                            <span data-bind="text: $root.texts.applyGlobally.name()">Apply Globally</span>
                        </btn>
                    </div>
                </div>
            </div>
        </div>
        <!-- #/factory-config-dialog -->
        <!-- #good-consumption-upgrade-dialog -->
        <div id="good-consumption-upgrade-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" data-bind="with: $root.selectedGoodConsumptionUpgradeList()">
                    <div class="modal-header">
                        <h4 data-bind="text: $root.texts.needConsumption.name">Need Consumption</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                    </div>
                    <div class="modal-body">
                        <h6 data-bind="text: $root.texts.newspaper.name">Newspaper</h6>
                        <form>
                            <div class="form mb-3" data-bind="foreach: $root.newspaperConsumption.allEffects">
                                <span class="custom-control custom-checkbox" data-bind="visible: $data.visible()">
                                    <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.guid + '-checked' }">
                                    <label class="custom-control-label" data-bind="text: $data.name() + ' ' + formatPercentage($data.amount), attr: { for: $data.guid + '-checked' }" src-only style="vertical-align: top;"></label>
                                </span>
                            </div>

                            <div class="form-inline">
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" data-bind="text: $root.texts.newspaperEffectiveness.name">Newspaper Effectiveness</span>
                                    </div>

                                    <select class="custom-select" data-bind="value: $root.newspaperConsumption.selectedBuff, options: $root.newspaperConsumption.selectableBuffs, optionsText: p => formatPercentage(p)"></select>
                                </div>

                                <div class="custom-control">
                                    <span data-bind="text: $root.texts.reducedNeeds.name">Reduced Needs</span>
                                    <span>: </span>
                                    <span data-bind="text: formatPercentage($root.newspaperConsumption.amount())"></span>
                                </div>
                            </div>
                        </form>
                        <table class="table table-striped">
                            <tbody data-bind="foreach: $data.upgrades">
                                <tr>
                                    <td>

                                        <span class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" data-bind="checked: $data.upgrade.checked, attr: { id: $data.upgrade.guid + '-checked' }">
                                            <label class="custom-control-label" data-bind="attr: { for: $data.upgrade.guid + '-checked' }" src-only style="vertical-align: top;"></label>
                                        </span>
                                    </td>
                                    <td><img class="icon-sm" src="" data-bind="attr: { src: $data.upgrade.icon ? $data.upgrade.icon : null}"></td> <!-- upgrade icon -->
                                    <td data-bind="text: $data.upgrade.name"></td> <!-- upgrade name -->
                                    <td><span data-bind="text: formatPercentage($data.amount)"></span></td>

                                </tr>
                            </tbody>
                        </table>

                        <div data-bind="component: { name: 'notes-section', params:{ $data: $data.need}}"></div>
                    </div>
                    <div class="modal-footer">
                        <span data-bind="text: $root.texts.total.name">Total</span>
                        <span>: </span>
                        <span data-bind="text: formatPercentage($data.amount())"></span>
                        <button data-dismiss="modal" class="btn btn-light btn-sm" data-bind="visible: !$root.settings.autoApplyConsumptionUpgrades.checked(), click: () => $data.apply()">
                            <span data-bind="text: $root.texts.apply.name">Apply</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- #/good-consumption-upgrade-dialog -->
        <!-- #contract-management-dialog -->
        <div id="contract-management-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" data-bind="if: $root.dlcsMap.get('dlc7')">
                    <div class="modal-header">
                        <h4 data-bind="text: $root.texts.docklands.name">Trade Contracts</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>

                    </div>
                    <div class="modal-body">
                        <div data-bind="with: $root.contractUpgradeManager">
                            <h5 data-bind="text: $root.texts.exportPyramid.name">Your Specialty Exports</h5>

                            <table class="table table-striped table-sm">
                                <tbody data-bind="foreach: $data.upgrades">
                                    <tr>
                                        <td>
                                            <img src="" class="icon-sm" data-bind="attr: {src: $data.product.icon}" />
                                            <span data-bind="text: $data.product.name()"></span>
                                        </td>
                                        <td>
                                            <span data-bind="text: $data.factor"></span>
                                            <span>x</span>
                                        </td>
                                        <td>
                                            <div class="float-right">
                                                <button class="btn btn-secondary btn-sm" data-bind="click: () => $data.delete()">
                                                    <span class="fa fa-trash"> </span>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <form class="form form-inline" data-bind="if: $data.factors().length" style="justify-content: space-between">

                                <select name="products" class="custom-select" id="contract-upgrades-products" data-bind="value: $data.product, options: $data.products, optionsText: i => i.name()"></select>
                                <select name="factors" class="custom-select" id="contract-upgrades-factors" data-bind="value: $data.factor, options: $data.factors, optionsText: i => i + 'x'"></select>

                                <button class="btn btn-sm btn-light" data-bind="click: () => $data.create(), enable: $data.canCreate()">
                                    <span class="fa fa-plus"></span>
                                </button>
                            </form>
                        </div>
                        <hr />
                        <div data-bind="with: $root.selectedContractManager()">
                            <div class="inline-list-stretched" data-bind="if: !view.island().isAllIslands()">
                                <div class="input-group spinner" style="max-width: 14rem;">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" data-bind="text: $root.texts.loadingSpeed.name()"></span>
                                    </div>
                                    <input step="0.1" min="1" class="form-control" type="number" value="100" data-bind="value: $data.traderLoadingSpeed, attr: { id: 'trader-loading-speed' }" />
                                    <div class="input-group-append">
                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.traderLoadingSpeed, id: 'trader-loading-speed' }}"></div>
                                        <span class="input-group-text">t/s</span>

                                    </div>
                                </div>

                                <div class="input-group spinner" style="max-width: 11rem;">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" data-bind="text: $root.texts.travelTime.name()"></span>
                                    </div>
                                    <input step="1" min="20" class="form-control" type="number" value="24" data-bind="value: $data.traderTransferTime, attr: { id: 'trader-transfer-time' }" />
                                    <div class="input-group-append">
                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.traderTransferTime, id: 'trader-transfer-time' }}"></div>
                                        <span class="input-group-text">min</span>

                                    </div>
                                </div>

                                <div class="input-group spinner" style="max-width: 19rem;">
                                    <input step="100" min="100" class="form-control" type="number" value="2000" data-bind="value: $data.existingStorageCapacity, attr: { id: 'existing-storage-capacity' }" />
                                    <div class="input-group-append">
                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.existingStorageCapacity, id: 'existing-storage-capacity' }}"></div>
                                        <span class="input-group-text">t</span>
                                        <button class="btn btn-sm btn-light" data-bind="click: () => $data.setStorageCapacity(), enable: $data.contracts().length, attr: {'title': $root.texts.setTotalCapacityTooltip.name()}">
                                            <span data-bind="text: $root.texts.setTotalCapacity.name()">Set total capacity</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="inline-list-stretched mt-2" data-bind="visible: !view.island().isAllIslands()">

                                <div>
                                    <span data-bind="text: $root.texts.duration.name()"></span>
                                    <span>: </span>
                                    <span data-bind="text: formatNumber($data.traderLoadingDuration())"></span>
                                    <span> min</span>
                                </div>
                                <div>
                                    <span data-bind="text: $root.texts.total.name()"></span>
                                    <span>: </span>
                                    <span data-bind="text: formatNumber($data.totalAmount())"></span>
                                    <span> t/min</span>
                                </div>
                                <div>
                                    <span data-bind="text: $root.texts.totalCapacity.name()"></span>
                                    <span>: </span>
                                    <span data-bind="text: formatNumber($data.storageCapacity())"></span>
                                    <span> t</span>
                                </div>

                            </div>

                            <table class="table table-striped table-sm mt-3">
                                <tbody data-bind="foreach: contracts">
                                    <tr>
                                        <td  data-bind="visible: !view.island().isAllIslands(), component: { name: 'lock-toggle', params: { checked: $data.fixed }, attr: {'title': $root.texts.fixContractTooltip.name()}} ">
                                        </td>
                                        <td>
                                            <div>
                                                <div class="input-group spinner input-transfer-amount">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <img class="icon-sm icon-light" src="icon_transporter_unloading_light.png" />
                                                            <a href="#" data-dismiss="modal" data-bind="click: () => {$root.selectedFactory($data.exportFactory); setTimeout(() => {$('#factory-config-dialog').modal('show')}, 500);}, attr: {title: $data.exportFactory.name()}" style="margin: 0 0.25rem;">
                                                                <img class="icon-sm" src="" data-bind="attr: { src: $data.exportFactory.icon ? $data.exportFactory.icon : null, alt: $data.exportFactory.name}">
                                                            </a>
                                                        </span>
                                                        <span data-bind="if: $root.settings.missingBuildingsHighlight.checked() && $data.exportFactory.overProduction() < -ACCURACY">
                                                            <span class="fa fa-exclamation-triangle danger-icon"></span>
                                                        </span>
                                                    </div>
                                                    <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: exportAmount, attr: { id: $data.exportFactory.guid + '-' + $data.importFactory.guid + '-export-amount-input' }" />
                                                    <div class="input-group-append">
                                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.exportAmount, id: $data.exportFactory.guid + '-' + $data.importFactory.guid + '-export-amount-input' }}"></div>
                                                        <div class="input-group-text">
                                                            <span data-bind="visible: view.island().isAllIslands()">t/min</span>
                                                            <span data-bind="text: 't/min (' + formatNumber($data.exportCount()) + ' t)', visible: !view.island().isAllIslands()"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td><span>&rarr;</span></td>
                                        <td>
                                            <div>
                                                <div class="input-group spinner input-transfer-amount">
                                                    <div class="input-group-prepend">
                                                        <span class="input-group-text">
                                                            <img class="icon-sm icon-light" src="icon_transporter_loading_light.png" />
                                                            <a href="#" data-dismiss="modal" data-bind="click: () => {$root.selectedFactory($data.importFactory); setTimeout(() => {$('#factory-config-dialog').modal('show')}, 500);}, attr: {title: $data.importFactory.name()}" style="margin: 0 0.25rem;">
                                                                <img class="icon-sm" src="" data-bind="attr: { src: $data.importFactory.icon ? $data.importFactory.icon : null, alt: $data.importFactory.name}">
                                                            </a>
                                                        </span>
                                                    </div>
                                                    <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: importAmount, attr: { id: $data.exportFactory.guid + '-' + $data.importFactory.guid + '-import-amount-input' }" />
                                                    <div class="input-group-append">
                                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.importAmount, id: $data.exportFactory.guid + '-' + $data.importFactory.guid + '-import-amount-input' }}"></div>
                                                        <div class="input-group-text">
                                                            <span data-bind="visible: view.island().isAllIslands()">t/min</span>
                                                            <span data-bind="text: 't/min (' + formatNumber($data.importCount()) + ' t)', visible: !view.island().isAllIslands()"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <span data-bind="text: Math.round(1000 * Math.max(1, $data.ratio()))/1000 "></span>
                                            <span> : </span>
                                            <span data-bind="text: Math.round(1000 * Math.max(1, 1/$data.ratio()))/1000 "></span>
                                        </td>
                                        <td>
                                            <div class="float-right">
                                                <button class="btn btn-secondary btn-sm" data-bind="click: () => $data.delete()">
                                                    <span class="fa fa-trash"> </span>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- #/contract-management-dialog -->
        <div class="animate-bottom">
            <!-- population input field -->
            <fieldset class="ui-fieldset" id="residents-view">
                <legend data-bind="text:$root.texts.residents.name">Residents</legend>

                <div class="inline-list-stretched">

                    <div class="ui-tier-input fleft">
                        <!-- <div class="ui-tier-icon">
                            <img src="/img/icons/gui_icon_map_0-17-10.png" alt="Old World" width="46" height="46">
                        </div> -->
                        <div data-bind="foreach: $root.template.populationLevels">
                            <div class="ui-tier-unit" data-bind="visible: $data.instance().visible()">
                                <div style="margin-left: 100%;direction: rtl;" class="">
                                    <div style="position: absolute;">
                                        <button class="btn btn-light btn-sm" data-bind="click: () => {$root.selectedPopulationLevel($data.instance())}" data-toggle="modal" data-target="#population-level-config-dialog">
                                            <span class="fa fa-sliders"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="ui-tier-unit-icon mb-1">
                                    <img class="icon-tile" src="" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">
                                    <img src="icon_residence.png" class="subscript-icon" data-bind="visible: $root.settings.populationInput() != '0'">
                                    <img src="icon_house.png" class="subscript-icon" data-bind="visible: $root.settings.populationInput() == '0'" style="margin-bottom: -5px;">
                                </div>
                                <div class="ui-tier-unit-name" data-bind="visible: !$root.settings.hideNames.checked(), attr: {'tier-unit-guid' : guid}">
                                    <span data-bind="visible: hotkey, text: hotkey() ? '[' + hotkey().toUpperCase() + '] ' : ''"></span>
                                    <span data-bind="text: name"></span>
                                </div>

                                <div class="input text">

                                    <div data-bind="visible: $root.settings.populationInput() == '0'">
                                        <div class="input-group input-group-sm spinner mb-3">
                                            <input step="10" class="form-control input-lg" type="number" value="0" min="0" data-bind="value:  $data.instance().existingBuildings, attr: {title: 'Press '+name()[0]+' to focus', id: $data.guid + '-existingBuildings-input' };" />
                                            <div class="input-group-append">
                                                <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.instance().existingBuildings, id: $data.guid + '-existingBuildings-input' }}"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div data-bind="visible: $root.settings.populationInput() == '1'">
                                        <div class="input-group input-group-sm spinner mb-3">
                                            <input step="100" class="form-control input-lg" type="number" value="0" min="0" data-bind="value: $data.instance().amount, attr: {title: 'Press '+name()[0]+' to focus', id: $data.guid + '-amount-input' };" />
                                            <div class="input-group-append">
                                                <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.instance().amount, id: $data.guid + '-amount-input' }}"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div data-bind="visible: $root.settings.populationInput() == '2'">
                                        <div class="input-group input-group-sm spinner mb-3">
                                            <input step="100" class="form-control input-lg" type="number" value="0" min="0" data-bind="value: $data.instance().limit, attr: {title: 'Press '+name()[0]+' to focus', id: $data.guid + '-limit-input' };" />
                                            <div class="input-group-append">
                                                <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.instance().limit, id: $data.guid + '-limit-input' }}"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <btn class="btn btn-light float-right align-middle" data-bind="click: () => $root.island().reset(), text: $root.texts.reset.name()">Reset</btn>
                </div>
            </fieldset>
            <!-- /population input field -->
            <!-- required workforce field -->
            <fieldset class="ui-fieldset" id="workforce-view" data-bind="visible: $root.island().workforceSectionVisible()">
                <legend class="collapser" data-toggle="collapse" data-target="#workforce">
                    <span class="fa fa-chevron-right"></span>
                    <span class="fa fa-chevron-down"></span>
                    <span data-bind="text:$root.texts.workforce.name"></span>
                </legend>

                <div id="workforce" class="collapse show" data-bind="with: $root.island()">
                    <div class="inline-list-stretched">
                        <div class="ui-tier-input fleft">
                            <div data-bind="foreach: $data.commuterPier.checked() ? $data.session.workforce : $data.workforce">
                                <div class="ui-tier-unit" data-bind="visible: $data.visible()">
                                    <div class="ui-tier-unit-icon"><img class="icon-tile" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }"></div>
                                    <!--<div class="ui-tier-unit-name" data-bind="text: name"></div>-->
                                    <div class="ui-fchain-item-count">
                                        <span data-bind="text: formatNumber($data.amount())"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="custom-control custom-checkbox float-right align-middle" data-bind="visible: $data.commuterPier.visible()">
                            <input id="commuterPier" class="custom-control-input" type="checkbox" data-bind="checked: $data.commuterPier.checked" />
                            <label class="custom-control-label" data-bind="text: $data.commuterPier.name" for="commuterPier">Commuter Pier</label>
                        </div>
                    </div>


                    <div class="clear"></div>
                </div>
            </fieldset>
            <!-- /required workforce field -->
            <!-- public buildings -->
            <fieldset class="ui-fieldset" id="categories-view" data-bind="visible: $root.island().publicBuildingsSectionVisible()">
                <legend class="collapser" data-toggle="collapse" data-bind="attr: {'data-target' : '#category-public-buildings'}">
                    <span class="fa fa-chevron-right"></span>
                    <span class="fa fa-chevron-down"></span>
                    <span data-bind="text:$root.texts.publicBuildings.name"></span>
                </legend>

                <div class="ui-fchain collapse show" data-bind="attr: {id:  'category-public-buildings'}">
                    <div data-bind="foreach: $root.template.powerPlants">

                        <!-- power plants -->
                        <div class="ui-service-building-item" data-bind="visible: $data.instance().visible()">
                            <div class="ui-fchain-item-tr-button">
                                <div>
                                    <button class="btn btn-light btn-sm" data-bind="click: () => {$root.selectedFactory($data.instance())}" data-toggle="modal" data-target="#factory-config-dialog">
                                        <span class="fa fa-sliders"></span>
                                    </button>
                                </div>
                            </div>

                            <div class="ui-fchain-item-name" data-bind="text: $data.getRegionExtendedName(), visible: !$root.settings.hideNames.checked()"></div>
                            <div class="ui-fchain-item-icon mb-2"><img class="icon-tile" src="" data-bind="attr: { src: $data.icon, alt: $data.name }"></div>


                            <!-- buildings input  -->
                            <div class="ui-fchain-item-count">
                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">

                                    <div class="input-group input-group-sm mb-3 spinner">
                                        <input class="form-control" type="number" value="0" step="1" min="0" data-bind="value:  $data.instance().existingBuildings, attr: { id: $data.guid + '-existingBuildings-input'}" />
                                        <div class="input-group-append">
                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.instance().existingBuildings, id: $data.guid + '-existingBuildings-input' }}"></div>
                                            <span class="input-group-text">x</span>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!-- buildings counter -->
                            <div class="ui-fchain-item-count" data-bind="visible:  $data.instance().buildings() >  $data.instance().existingBuildings()">
                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildingsDescription.name}">
                                    <span data-bind="text: $root.texts.requiredNumberOfBuildings.name"></span>
                                    <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? formatNumber( $data.instance().buildings()) : Math.ceil( $data.instance().buildings())"></span>
                                    <span>x</span>
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-secondary" data-bind="click: () =>  $data.instance().incrementBuildings(), enable:  $data.instance().buildings() > 0" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">+</button>
                                        <button type="button" class="btn btn-secondary" data-bind="click: () =>  $data.instance().decrementBuildings(), enable:  $data.instance().buildings() > 1.00001" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">-</button>
                                    </div>
                                </div>
                            </div>

                            <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                <div class="ui-fchain-item-load"><span data-bind="text: formatNumber($data.instance().amount())"></span><span> t/min</span></div>

                            </div>
                        </div>

                    </div>
                    <!-- /power plants -->
                    <!-- public services-->
                    <div data-bind="foreach: $root.template.publicServices">


                        <div class="ui-service-building-item" data-bind="visible: $data.instance().visible()">
                            <div class="ui-fchain-item-tr-button">
                                <div>
                                    <button class="btn btn-light btn-sm" data-bind="click: () => {$root.selectedFactory($data.instance())}" data-toggle="modal" data-target="#factory-config-dialog">
                                        <span class="fa fa-sliders"></span>
                                    </button>
                                </div>
                            </div>

                            <div class="ui-fchain-item-name" data-bind="text: $data.getRegionExtendedName(), visible: !$root.settings.hideNames.checked()"></div>
                            <div class="ui-fchain-item-icon mb-2"><img class="icon-tile" src="" data-bind="attr: { src: $data.icon, alt: $data.name }"></div>


                            <!-- buildings input  -->
                            <div class="ui-fchain-item-count">
                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">

                                    <div class="input-group input-group-sm mb-3 spinner">
                                        <input class="form-control" type="number" value="0" step="1" min="0" data-bind="value:  $data.instance().existingBuildings, attr: { id: $data.guid + '-existingBuildings-input'}" />
                                        <div class="input-group-append">
                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.instance().existingBuildings, id: $data.guid + '-existingBuildings-input' }}"></div>
                                            <span class="input-group-text">x</span>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!-- buildings counter -->
                            <div class="ui-fchain-item-count" data-bind="visible:  $data.instance().buildings() >  $data.instance().existingBuildings()">
                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildingsDescription.name}">
                                    <span data-bind="text: $root.texts.requiredNumberOfBuildings.name"></span>
                                    <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? formatNumber( $data.instance().buildings()) : Math.ceil( $data.instance().buildings())"></span>
                                    <span>x</span>
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-secondary" data-bind="click: () =>  $data.instance().incrementBuildings(), enable:  $data.instance().buildings() > 0" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">+</button>
                                        <button type="button" class="btn btn-secondary" data-bind="click: () =>  $data.instance().decrementBuildings(), enable:  $data.instance().buildings() > 1.00001" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">-</button>
                                    </div>
                                </div>
                            </div>

                            <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                <div class="ui-fchain-item-load"><span data-bind="text: formatNumber($data.instance().amount())"></span><span> t/min</span></div>

                            </div>
                        </div>

                    </div>
                    <!-- /public services -->
                    <!-- products without factories: mail and research papers -->
                    <div data-bind="foreach: $root.island().noFactoryProducts">
                        <div class="ui-service-building-item" data-bind="visible: $data.visible">


                            <div class="ui-fchain-item-name" data-bind="text: $data.name(), visible: !$root.settings.hideNames.checked()"></div>
                            <div class="ui-fchain-item-icon mb-2"><img class="icon-tile" src="" data-bind="attr: { src: $data.icon, alt: $data.name }"></div>

                            <div style="margin-top: 1rem; display: flex; flex-flow: column; height: calc(100% - 3rem  - 55px); justify-content: space-between;">
                                <div class="ui-fchain-item-count">

                                    <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.residents.name}">
                                        <img class="icon-sm icon-light" src="icon_resource_population.png" />
                                        <span data-bind="text: formatNumber(Math.round($data.residentsInput()))"></span>
                                    </span>


                                </div>

                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                    <div class="ui-fchain-item-load"><span data-bind="text: formatNumber($data.amount())"></span><span> t/min</span></div>

                                </div>
                            </div>
                        </div>

                    </div>
                    <!-- /products without factories: mail and research papers -->
                    <!-- public recipe buildings -->
                    <div data-bind="foreach: $root.island().recipeLists">

                        <div class="ui-service-building-item" data-bind="visible: $data.visible()">


                            <div class="ui-fchain-item-name" data-bind="text: $data.name, visible: !$root.settings.hideNames.checked()"></div>
                            <div class="ui-fchain-item-icon mb-2"><img class="icon-tile" src="" data-bind="attr: { src: $data.icon, alt: $data.name }"></div>


                            <div class="form-group">
                                <select class="custom-select form-control" data-bind="value: $data.selectedRecipe, options: $data.unusedRecipes, optionsText: r => r.recipeName()"></select>
                            </div>

                            <div style="margin: -10px;">


                                <button data-bind="click: () => $data.create(), enable: $data.canCreate" class="btn btn-secondary btn-sm btn-light" style="width: 100%;">
                                    <span class="fa fa-plus"></span>
                                </button>
                            </div>
                        </div>

                    </div>
                    <!-- /public recipe buildings -->
                    <!-- recipes -->
                    <div data-bind="foreach: $root.template.publicRecipeBuildings">

                        <div class="ui-fchain-item" data-bind="visible: $data.instance().visible() && $data.instance().existingBuildings() > 0">
                            <div class="ui-fchain-item-tr-button">
                                <div>
                                    <button class="btn btn-light btn-sm" data-bind="click: () => {$root.selectedFactory($data.instance())}" data-toggle="modal" data-target="#factory-config-dialog">
                                        <span class="fa fa-sliders"></span>
                                    </button>
                                </div>
                            </div>

                            <div class="ui-fchain-item-name" data-bind="text:  $data.recipeName(), visible: !$root.settings.hideNames.checked()"></div>
                            <div class="ui-fchain-item-icon mb-2"><img class="icon-tile" src="" data-bind="attr: { src: $data.icon, alt: $data.name }"></div>


                            <!-- buildings counter -->
                            <div class="ui-fchain-item-count">
                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">

                                    <div class="input-group input-group-sm mb-3 spinner">
                                        <input class="form-control" type="number" value="0" step="1" min="0" data-bind="value:  $data.instance().existingBuildings, attr: { id: $data.guid + '-existingBuildings-input'}" />
                                        <div class="input-group-append">
                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.instance().existingBuildings, id: $data.guid + '-existingBuildings-input' }}"></div>
                                            <span class="input-group-text">x</span>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="custom-control custom-checkbox" data-bind="with: $data.instance().goodConsumptionUpgrade" style="word-break: break-word;height:2.5rem;">
                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.guid + '-building-input' }">
                                <label class="custom-control-label" data-bind="text: $root.texts.supplyEffects.name, attr: { for: $data.guid + '-building-input'}"></label>
                            </div>

                            <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                <div class="ui-fchain-item-load"><span data-bind="text: formatNumber($data.instance().amount())"></span><span> t/min</span></div>

                            </div>
                        </div>

                    </div>
                    <!-- /recipes -->
                </div>
                <div class="clear"></div>
            </fieldset>

            <!-- /public buildings -->
            <!-- required factories by category -->
            <div data-bind="foreach: { data: $root.template.categories, as: 'category'}">
                <fieldset class="ui-fieldset" id="categories-view">
                    <legend class="collapser" data-toggle="collapse" data-bind="attr: {'data-target' : '#category-' + guid}">
                        <span class="fa fa-chevron-right"></span>
                        <span class="fa fa-chevron-down"></span>
                        <span data-bind="text:name"></span>
                    </legend>

                    <div class="ui-fchain collapse show" data-bind="attr: {id:  'category-' + guid}">
                        <div data-bind="foreach: $data.products">
                            <div data-bind="foreach: $data.factories">
                                <div data-bind="visible: $data.instance().visible">

                                    <div class="ui-fchain-item" data-bind="css: $root.settings.missingBuildingsHighlight.checked() &&  $data.instance().buildings() >  $data.instance().existingBuildings() + ACCURACY ? 'danger' : ''">
                                        <div class="ui-fchain-item-tr-button">
                                            <div>
                                                <button class="btn btn-light btn-sm" data-bind="click: () => {$root.selectedFactory($data.instance())}" data-toggle="modal" data-target="#factory-config-dialog">
                                                    <span class="fa fa-sliders"></span>
                                                </button>
                                            </div>
                                        </div>

                                        <div class="ui-fchain-item-name" data-bind="text: $data.getRegionExtendedName(), visible: !$root.settings.hideNames.checked()"></div>

                                        <div class="ui-fchain-item-icon mb-2">
                                            <img class="icon-tile" src="" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">
                                        </div>
                                        <div class="ui-fchain-item-boost">
                                            <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.productionBoost.name}, visible: !$root.settings.hideProductionBoost.checked()">
                                                <div class="input-group input-group-sm mb-3 spinner">
                                                    <input class="form-control" type="number" value="100" step="1" min="1" data-bind="value:  $data.instance().percentBoost, attr: {id: $data.guid + '-percentBoost-input'}" />
                                                    <div class="input-group-append">
                                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.instance().percentBoost, id: $data.guid + '-percentBoost-input' }}"></div>
                                                        <span class="input-group-text">%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="ui-fchain-item-attribute-group">
                                            <div>
                                                <!-- buildings display for non-construction products -->
                                                <div class="ui-fchain-item-count" data-bind="visible: !$data.editable()">
                                                    <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">
                                                        <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? formatNumber($data.instance().buildings()) : Math.ceil( $data.instance().buildings())"></span>
                                                        <span>x</span>
                                                        <div class="btn-group" role="group" data-bind="if: !$root.settings.simpleView.checked()">
                                                            <button type="button" class="btn btn-secondary" data-bind="click: () => $data.instance().incrementBuildings(), enable:  $data.instance().buildings() > 0" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">+</button>
                                                            <button type="button" class="btn btn-secondary" data-bind="click: () => $data.instance().decrementBuildings(), enable:  $data.instance().buildings() >= 1.01" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">-</button>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- existing buildings input for non-construction products -->
                                                <div class="ui-fchain-item-count" data-bind="visible: !$data.editable() && $root.settings.missingBuildingsHighlight.checked() && (!$data.instance().region || !$data.instance().island.region || $data.instance().region === $data.instance().island.region)">
                                                    <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.existingNumberOfBuildings.name}">
                                                        <span data-bind="text: $root.texts.existingNumberOfBuildingsIs.name"></span>
                                                        <span data-bind="text: $data.instance().existingBuildings()"></span>
                                                        <span>x</span>
                                                        <div class="btn-group" role="group">
                                                            <button type="button" class="btn btn-secondary" data-bind="click: () => $data.instance().existingBuildings(parseInt($data.instance().existingBuildings())+1)" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">+</button>
                                                            <button type="button" class="btn btn-secondary" data-bind="click: () => $data.instance().existingBuildings(parseInt($data.instance().existingBuildings())-1), enable: $data.instance().existingBuildings() >= 1" style="padding: 0em 0.25em 0em 0.25em; font-size: unset;">-</button>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- buildings input for construction material -->
                                                <div class="ui-fchain-item-count" data-bind="visible: $data.editable() && (!$data.instance().region || !$data.instance().island.region || $data.instance().region === $data.instance().island.region)">
                                                    <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">

                                                        <div class="input-group input-group-sm mb-3 spinner">
                                                            <input class="form-control" type="number" value="0" step="1" min="0" data-bind="value:  $data.instance().existingBuildings, attr: {id: $data.guid + '-existingBuildings-input'}" />
                                                            <div class="input-group-append">
                                                                <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.instance().existingBuildings, id: $data.guid + '-existingBuildings-input' }}"></div>
                                                                <span class="input-group-text">x</span>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>

                                                <!-- required buildings display for construction materials -->
                                                <div class="ui-fchain-item-count" data-bind="visible: $data.editable() &&  $data.instance().buildings() > $data.instance().existingBuildings()">
                                                    <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildingsDescription.name}" style="display: flex">
                                                        <span data-bind="text: $root.texts.requiredNumberOfBuildings.name"></span>
                                                        <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? formatNumber( $data.instance().buildings()) : Math.ceil( $data.instance().buildings())"></span>
                                                        <span>x</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- amount -->
                                            <div data-bind="if: !$root.settings.simpleView.checked()">
                                                <div class="ui-fchain-item-amount" href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                                    <div class="ui-fchain-item-load"><span data-bind="text: formatNumber($data.instance().amount())"></span><span> t/min</span></div>

                                                </div>
                                            </div>
                                            <div data-bind="if: $root.settings.simpleView.checked()">
                                                <div class="ui-fchain-item-amount" href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                                    <div class="ui-fchain-item-load"><span data-bind="text: formatNumber($data.instance().outputAmount() * $data.instance().extraGoodFactor())"></span><span> t/min</span></div>

                                                </div>
                                            </div>

                                            <div class="ui-fchain-item-module" data-bind="visible: !!$data.module || !!$data.palaceBuff">
                                                <div style="flex: 100 1 auto;"></div>

                                                <!-- module -->
                                                <div data-bind="if: !!$data.module && $data.module.visible()" style="flex: auto;">
                                                    <div class="custom-control custom-checkbox" data-bind="visible: !!$data.module">
                                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.instance().moduleChecked, attr: { id: category.guid + '-' + $data.guid + '-module' }">
                                                        <label class="custom-control-label" data-bind="attr: { for: category.guid + '-' + $data.guid + '-module', title: $data.module.name }" src-only style="vertical-align: top;">

                                                        </label>
                                                    </div>
                                                </div>
                                                <div data-bind="if: !!$data.module && $data.module.visible()" style="flex: auto;">
                                                    <img class="icon-sm" src="" data-bind="attr: { src: $data.module.icon ? $data.module.icon  : null, alt: $data.module.name, for: $data.guid + '-module', title: $data.module.name }" style="margin-right: 0.75em;margin-left: -0.25em;" />
                                                </div>

                                                <!-- fertilizerModule -->
                                                <div data-bind="if: !!$data.fertilizerModule && $data.fertilizerModule.visible() && !(!!$data.palaceBuff && !!$data.module)" style="flex: auto;">
                                                    <div class="custom-control custom-checkbox" data-bind="visible: !!$data.fertilizerModule">
                                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.instance().fertilizerModuleChecked, attr: { id: category.guid + '-' + $data.guid + '-fertilizerModule' }">
                                                        <label class="custom-control-label" data-bind="attr: { for: category.guid + '-' + $data.guid + '-fertilizerModule', title: $data.fertilizerModule.name }" src-only style="vertical-align: top;">

                                                        </label>
                                                    </div>
                                                </div>
                                                <div data-bind="if: !!$data.fertilizerModule&& $data.fertilizerModule.visible() && !(!!$data.palaceBuff && !!$data.module)" style="flex: auto;">
                                                    <img class="icon-sm" src="" data-bind="attr: { src: $data.fertilizerModule.icon ? $data.fertilizerModule.icon  : null, alt: $data.fertilizerModule.name, for: $data.guid + '-fertilizerModule', title: $data.fertilizerModule.name }" style="margin-right: 0.75em;margin-left: -0.25em;" />
                                                </div>

                                                <!-- palace buff -->
                                                <div data-bind="if: !!$data.palaceBuff && $data.palaceBuff.visible()" style="flex: auto;">
                                                    <div class="custom-control custom-checkbox" data-bind="visible: !!$data.palaceBuff">
                                                        <input type="checkbox" class="custom-control-input" data-bind="checked: $data.instance().palaceBuffChecked, attr: { id: category.guid + '-' + $data.guid + '-palaceBuff' }">
                                                        <label class="custom-control-label" data-bind="attr: { for: category.guid + '-' + $data.guid + '-palaceBuff', title: $data.palaceBuff.name }" src-only style="vertical-align: top;">

                                                        </label>
                                                    </div>
                                                </div>
                                                <div data-bind="if: !!$data.palaceBuff && $data.palaceBuff.visible()" style="flex: auto;">
                                                    <img class="icon-sm" src="" data-bind="attr: { src: $data.palaceBuff.icon ? $data.palaceBuff.icon  : null, alt: $data.palaceBuff.name, for: $data.guid + '-palaceBuff', title: $data.palaceBuff.name }" style="margin-right: 0.75em;margin-left: -0.25em;" />
                                                </div>
                                                <div style="flex: 100 1 auto;"></div>
                                            </div>
                                        </div>
                                        <div data-bind="if: !$root.settings.simpleView.checked()">
                                            <div class="ui-fchain-item-load" data-bind="visible: $root.settings.additionalProduction.checked() || $root.settings.tradeRoutes.checked() || $root.dlcsMap.get('dlc7').checked()">
                                                <div class="ui-fchain-item-extra-input">
                                                    <div class="input-group input-group-sm spinner mb-3">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text">+ </span>
                                                            <span data-bind="visible: $data.instance().extraAmount() < -ACCURACY  + $data.instance().computedExtraAmount()">
                                                                <span class="fa fa-exclamation-triangle danger-icon"></span>
                                                            </span>
                                                        </div>
                                                        <input step="0.1" class="form-control" type="number" value="0" data-bind="value: $data.instance().extraAmount, attr: {id: $data.guid + '-extraAmount-input'}" />
                                                        <div class="input-group-append">
                                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.instance().extraAmount, id: $data.guid + '-extraAmount-input' }}"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.outputAmount.name}" style="border-top-color: inherit; border-top-style: solid; border-top-width: 1px;">
                                                    <div class="ui-fchain-item-load"><span data-bind="text: formatNumber($data.instance().outputAmount())"></span><span> t/min</span></div>
                                                </div>

                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clear"></div>
                </fieldset>
            </div>
            <!-- /required factories by category -->
            <!-- production chains by population level -->
            <div data-bind="if: !$root.settings.simpleView.checked()">
                <div data-bind="foreach: { data:  $root.template.populationLevels, as: 'populationLevel'}">
                    <div data-bind="visible:  $data.instance().amount() ||  $data.instance().existingBuildings()">
                        <fieldset class="ui-fieldset" id="consumption-view">
                            <legend class="collapser" data-toggle="collapse" data-bind="attr: {'data-target' : '#consumption-' +  guid}">
                                <span class="fa fa-chevron-right"></span>
                                <span class="fa fa-chevron-down"></span>
                                <span data-bind="text:name"></span>
                            </legend>
                            <div class="collapse show" data-bind="foreach: needs, attr:{id: 'consumption-' +  guid}">
                                <div class="ui-fchain" data-bind="hidden: $data.instance().hidden && $data.instance().hidden(), css:{inactive: $data.instance().banned}">
                                    <div>
                                        <div class="ui-fchain-item">
                                            <div class="ui-fchain-item-tr-checkbox">
                                                <div>
                                                    <span class="custom-control custom-checkbox">
                                                        <input class="custom-control-input" data-bind="checked: $data.instance().checked, attr: { id: populationLevel.guid + '-' + $data.product.guid + '-checked' }" type="checkbox">
                                                        <label class="custom-control-label" src-only="" data-bind="attr: { for: populationLevel.guid + '-' + $data.product.guid + '-checked' }">&#8203;</label>
                                                    </span>
                                                </div>
                                            </div>

                                            <div class="ui-fchain-item-name" data-bind="text: product.name, visible: !$root.settings.hideNames.checked()"></div>
                                            <div class="ui-fchain-item-icon">
                                                <img class="icon-tile" src="" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name }">
                                            </div>

                                            <div data-bind="visible: $root.settings.consumptionModifier.checked()">
                                                <div class="card bg-light mb-2 mt-2">
                                                    <div style="display: flex; justify-content: space-between; vertical-align: bottom;">
                                                        <div>

                                                            <img class="icon-sm icon-light" src="icon_marketplace_2d_light.png" />
                                                        </div>
                                                        <div>
                                                            <button class="btn btn-light btn-sm" data-bind="click: () => {$root.selectedGoodConsumptionUpgradeList($data.instance().goodConsumptionUpgradeList)}" data-toggle="modal" data-target="#good-consumption-upgrade-dialog">
                                                                <span class="fa fa-sliders"></span>
                                                            </button>

                                                        </div>
                                                    </div>
                                                    <div class="input-group spinner" href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.consumptionModifier.name}, if: $root.settings.consumptionModifier.checked()" title="Verändere die prozentuale Verbrauchsmenge für diese Ware und Bevölkerungsstufe" style="">
                                                        <input class="form-control" type="number" value="100" step="0.1" min="1" data-bind="value:  $data.instance().percentBoost, attr: {id: $data.guid + '-percentBoost-input'}">
                                                        <div class="input-group-append">
                                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.instance().percentBoost, id: $data.guid + '-percentBoost-input' }}"></div>
                                                            <span class="input-group-text">%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div style="margin: auto">
                                                <div class="ui-fchain-item-count">
                                                    <div data-bind="if: $data.instance() instanceof NoFactoryNeed">
                                                        <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.residents.name}">
                                                            <img class="icon-sm icon-light" src="icon_resource_population.png" />
                                                            <span data-bind="text: formatNumber(Math.round($data.instance().product.residentsInput()))"></span>
                                                        </span>
                                                    </div>
                                                    <div data-bind="if: !($data.instance() instanceof NoFactoryNeed)">
                                                        <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">
                                                            <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? formatNumber($data.instance().buildings()) : formatNumber(Math.ceil($data.instance().buildings()))"></span>
                                                            <span>x</span>
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="ui-fchain-item-load">
                                                    <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                                        <span data-bind="text: formatNumber($data.instance().amount())"></span><span> t/min</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex flex-wrap align-content-start" data-bind="foreach: $data.allDemands">
                                        <div class="ui-fchain-spacer" data-bind="visible: $data.instance().amount()">
                                            ←
                                        </div>
                                        <div data-bind="visible: $data.instance().amount()">
                                            <div class="ui-fchain-item">

                                                <div class="ui-fchain-item-name" data-bind="text: product.name, visible: !$root.settings.hideNames.checked()"></div>
                                                <div class="ui-fchain-item-icon">
                                                    <img class="icon-tile" src="" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name }">
                                                </div>

                                                <div style="margin: auto">
                                                    <div data-bind="visible: $root.settings.consumptionModifier.checked() && !($data instanceof Need)">
                                                        <div style="height: calc(2.25rem + 2px);"></div>
                                                    </div>
                                                    <div class="ui-fchain-item-count">
                                                        <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.requiredNumberOfBuildings.name}">
                                                            <span data-bind="text: $root.settings.decimalsForBuildings.checked() ? formatNumber($data.instance().buildings()) : formatNumber(Math.ceil($data.instance().buildings()))"></span>
                                                            <span>x</span>
                                                        </span>

                                                    </div>
                                                    <div class="ui-fchain-item-load">
                                                        <span href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.tonsPerMinute.name}">
                                                            <span data-bind="text: formatNumber($data.instance().amount())"></span><span> t/min</span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="clear"></div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
            <!-- /production chains by population level -->
        </div>
    </div>
</body>
</html>