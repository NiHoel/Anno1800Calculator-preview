<div id="factory-config-dialog" class="modal fade" role="dialog" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" data-bind="with: $root.selectedFactory()">
            <div class="modal-header">
                <h4 data-bind="text: $data.name">Factory Name</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

            </div>
            <div class="modal-body">
                <div data-bind="if: $data.availableItems().length && $root.settings.additionalProduction.checked()">
                    <h6 data-bind="text: $root.texts.itemsEquipped.name">Equipped Items</h6>
                    <table class="table table-striped">
                        <tbody data-bind="foreach: $data.availableItems">
                            <tr>
                                <td>
                                    <div class="inline-list">
                                        <span class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: 'fc-' + $data.factory.guid + '-' + $data.item.guid + '-equipped' }">
                                            <label class="custom-control-label" data-bind="attr: { for: 'fc-' + $data.factory.guid + '-' + $data.item.guid + '-equipped', title: $data.factory.getRegionExtendedName() }" src-only style="vertical-align: top;">

                                            </label>
                                        </span>
                                        <img class="icon-sm" class="mr-2" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.item.icon ? $data.item.icon : null}"><!-- item icon -->
                                        <span data-bind="text: $data.name"></span> <!-- item name -->
                                    </div>
                                </td>
                                <td>
                                    <!-- extra goods -->
                                    <span data-bind="if: $data.item.extraGoods">
                                        <span data-bind="foreach: $data.extraGoods" class="inline-list-centered">
                                            <!-- icon extra goods -->
                                            <span style="flex: 100 1 auto;"></span>

                                            <span style="flex: auto;" daba-bind="visible: $data.product.visible()">
                                                <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.product.icon ? $data.product.icon  : null, alt: $data.product.name}" />
                                            </span>

                                            <span style="flex: 100 1 auto;"></span>
                                        </span>
                                    </span>
                                    <!-- input replacements -->
                                    <div data-bind="if: $data.replacementArray">
                                        <div data-bind="foreach: $data.replacementArray">
                                            <div class="ui-fchain-item-icon-replacement">
                                                <span class="strike-through">
                                                    <img src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.old.icon ? $data.old.icon : null, alt: $data.old.name }" width="30" height="30">
                                                </span>
                                                <div class="ui-replacement-spacer">
                                                    →
                                                </div>
                                                <img src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.new.icon ? $data.new.icon : null, alt: $data.new.name }" width="30" height="30">
                                            </div>
                                        </div>
                                    </div>
                                    <!-- workforce replacement -->
                                    <div data-bind="if: $data.replacingWorkforce && $parent.workforceDemand.isSwitch">
                                        <div class="ui-fchain-item-icon-replacement">
                                            <span class="strike-through">
                                                <img src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $parent.workforceDemand.defaultWorkforce.icon ? $parent.workforceDemand.defaultWorkforce.icon : null, alt: $parent.workforceDemand.defaultWorkforce.name }" width="30" height="30">
                                            </span>
                                            <div class="ui-replacement-spacer">
                                                →
                                            </div>
                                            <img src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $parent.workforceDemand.replacingWorkforce.icon ? $parent.workforceDemand.replacingWorkforce.icon : null, alt: $parent.workforceDemand.replacingWorkforce.name }" width="30" height="30">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <hr />
                </div>

                <div data-bind="if: $root.settings.tradeRoutes.checked() && $data.isFactory">
                    <div data-bind="with: $data.tradeList">

                        <h6><span data-bind="text: $root.settings.tradeRoutes.name">Trade Routes</span></h6>

                        <div class="mb-3 inline-list-stretched" data-bind="foreach: $data.npcRoutes">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.checked, attr: { id: $data.trader.guid + '-npcRoute-checked' }">
                                <label class="custom-control-label" data-bind="attr: { for: $data.trader.guid + '-npcRoute-checked' }" src-only style="vertical-align: top;">
                                    <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr:{src: $data.trader.icon}" />
                                    <span data-bind="text: $data.trader.name"></span>
                                </label>
                            </div>

                            <div>
                                <span data-bind="text: formatNumber($data.amount)"></span>
                                <span> t/min</span>
                            </div>
                        </div>

                        <table class="table table-striped table-sm" data-bind="if: !$data.island.isAllIslands()">
                            <tbody data-bind="foreach: $data.routes">
                                <tr>
                                    <td>
                                        <span data-bind="if: $data.getOpposite($parent).session">
                                            <img src="../icons/icon_marketplace_2d_light.png" class="icon-sm icon-light" data-bind="attr: {src: $data.getOpposite($parent).session.icon}" />
                                        </span>
                                        <a href="#" data-bind="text: $data.getOpposite($parent).name, click: () => {$root.selectedFactory($data.getOppositeFactory($parent.factory)); $root.island($data.getOpposite($parent))}"></a>
                                    </td> <!-- island name -->
                                    <!-- factory summary -->
                                    <!--<td data-bind="with: $data.getOpposite($parent)">
                                        <div style="display: flex; flex-flow: wrap; justify-content: center">
                                            <span class="mr-3">
                                                <img src="../icons/icon_resource_storage_amount.png" width="25" height="25">
                                            </span>
                                            <span data-bind="if: !$data.top5Factories().length">0</span>
                                            <span data-bind="foreach: $data.top5Factories" style="display: flex; flex-flow: wrap; justify-content: center">
                                                <span class="mr-1">
                                                    <img src="../icons/icon_marketplace_2d_light.png" width="25" height="25" data-bind="attr: { src: $data.icon ? $data.icon : null, alt: $data.name }">

                                                </span>
                                                <span class="mr-3" data-bind="text: $root.settings.missingBuildingsHighlight.checked() ? $data.existingBuildings() : Math.ceil($data.buildings())"></span>
                                            </span>
                                        </div>
                                    </td> -->

                                    <td>
                                        <div data-bind="if: $data.isExport($parent) && $parent.factory.overProduction() > ACCURACY">
                                            <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.exportOverproduction.name}">
                                                <span data-bind="text: formatNumber($parent.factory.overProduction())"></span>
                                                <button class="btn btn-light btn-sm" data-bind="click: () => $data.amount($data.amount() + $parent.factory.overProduction())">
                                                    <span class="fa fa-sign-in"> </span>
                                                </button>
                                            </div>
                                        </div>
                                        <div data-bind="if: !$data.isExport($parent) && $parent.factory.overProduction() < -ACCURACY">
                                            <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.importDeficit.name}">
                                                <span data-bind="text: formatNumber(-$parent.factory.overProduction())"></span>
                                                <button class="btn btn-light btn-sm" data-bind="click: () => $data.amount($data.amount() - $parent.factory.overProduction())">
                                                    <span class="fa fa-sign-in"> </span>
                                                </button>
                                            </div>
                                        </div>
                                    </td>
                                    <td>

                                        <div class="input-group spinner" style="max-width: 12rem">
                                            <div class="input-group-prepend">
                                                <div class="input-group-text">
                                                    <span data-bind="if: $data.isExport($parent)">

                                                        <img class="icon-sm icon-light" src="../icons/icon_transporter_unloading_light.png" />
                                                    </span>
                                                    <span data-bind="if: !$data.isExport($parent)">

                                                        <img class="icon-sm icon-light" src="../icons/icon_transporter_loading_light.png" />
                                                    </span>
                                                </div>
                                                <span data-bind="if: !$data.isExport($parent) && $root.settings.missingBuildingsHighlight.checked() && $data.fromFactory.overProduction() < -ACCURACY">
                                                    <span class="fa fa-exclamation-triangle danger-icon"></span>
                                                </span>
                                            </div>
                                            <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: amount, attr: {id: $data.guid + '-amount-input' } " />
                                            <div class="input-group-append">
                                                <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.amount, id: $data.guid + '-amount-input' }}"></div>
                                                <span class="input-group-text">t/min</span>
                                            </div>
                                        </div>

                                    </td>
                                    <td>

                                        <button class="btn btn-secondary btn-sm float-right" data-bind="click: () => $data.delete()">
                                            <span class="fa fa-trash"> </span>
                                        </button>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <form class="form form-inline" data-bind="if: $data.unusedIslands().length && !$data.island.isAllIslands() " style="justify-content: space-between">

                            <select name="islands" class="custom-select" id="islands" data-bind="value: $data.selectedIsland, options: $data.unusedIslands, optionsText: i => i.sessionExtendedName() /* + '\t' + i.assetsMap.get($data.factory.guid).overProduction() + ' t/min' */"></select>
                            <div style="display: flex">
                                <div class="mr-2">

                                    <img class="icon-sm icon-light" src="../icons/icon_transporter_loading_light.png" />
                                </div>
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="create-trade-route-export-checkbox" data-bind="checked: $data.export">
                                    <label class="custom-control-label" for="create-trade-route-export-checkbox">

                                        <img class="icon-sm icon-light" src="../icons/icon_transporter_unloading_light.png" />
                                    </label>
                                </div>
                            </div>
                            <div class="input-group input-group-short spinner">

                                <input step="0.1" class="form-control" type="number" value="0" data-bind="value: newAmount" />
                                <div class="input-group-append">
                                    <span class="input-group-text">t/min</span>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-light" data-bind="click: () => $data.create(), enable: $data.canCreate()">
                                <span class="fa fa-plus"></span>
                            </button>
                        </form>
                    </div>
                    <hr />
                </div>

                <div data-bind="if:  $root.dlcsMap.get('dlc7').checked() && $data.isFactory && $data.getProduct().exchangeWeight">
                    <div data-bind="with: $data.contractList">

                        <h6><span data-bind="text: $root.texts.docklands.name">Trade Contracts</span></h6>


                        <div data-bind="if: $data.exports().length || $data.imports().length">
                            <table class="table table-striped table-sm">
                                <tbody>
                                    <!-- export contracts -->
                                    <!-- ko foreach: $data.exports -->
                                    <tr>
                                        <td>
                                            <div class="input-group spinner input-transfer-amount">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <img class="icon-sm icon-light" src="../icons/icon_transporter_loading_light.png" />

                                                        <a href="#" data-bind="click: () => {$root.selectedFactory($data.importFactory)}, attr: {title: $data.importFactory.name()}" style="margin: 0 0.25rem;">
                                                            <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.importFactory.icon ? $data.importFactory.icon : null, alt: $data.importFactory.name}">
                                                        </a>
                                                    </span>
                                                </div>
                                                <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: importAmount, attr: {id: $data.importFactory.guid + '-export-contract-import-amount-input' } " />
                                                <div class="input-group-append">
                                                    <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.importAmount, id: $data.importFactory.guid + '-export-contract-import-amount-input' }}"></div>
                                                    <span class="input-group-text">t/min</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td><span>&larr;</span></td>
                                        <td>
                                            <div class="float-right" data-bind="if: $parent.factory.overProduction() > ACCURACY">
                                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.exportOverproduction.name}">
                                                    <span data-bind="text: formatNumber($parent.factory.overProduction())"></span>
                                                    <button class="btn btn-light btn-sm" data-bind="click: () => $data.exportAmount($data.exportAmount() + $parent.factory.overProduction())">
                                                        <span class="fa fa-sign-in"> </span>
                                                    </button>
                                                </div>
                                            </div>
                                        </td>
                                        <td>

                                            <div class="input-group spinner float-right input-transfer-amount">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <img class="icon-sm icon-light" src="../icons/icon_transporter_unloading_light.png" />
                                                        <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.exportFactory.icon ? $data.exportFactory.icon : null, alt: $data.exportFactory.name}" style="margin: 0 0.25rem;">

                                                    </span>
                                                </div>
                                                <span data-bind="if: $root.settings.missingBuildingsHighlight.checked() && $data.exportFactory.overProduction() < -ACCURACY">
                                                    <span class="fa fa-exclamation-triangle danger-icon"></span>
                                                </span>
                                                <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: exportAmount, attr: {id: $data.importFactory.guid + '-export-contract-export-amount-input' } " />
                                                <div class="input-group-append">
                                                    <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.exportAmount, id: $data.importFactory.guid + '-export-contract-export-amount-input' }}"></div>
                                                    <span class="input-group-text">t/min</span>
                                                </div>
                                            </div>

                                        </td>
                                        <td>

                                            <button class="btn btn-secondary btn-sm float-right" data-bind="click: () => $data.delete()">
                                                <span class="fa fa-trash"> </span>
                                            </button>

                                        </td>
                                    </tr>
                                    <!-- /ko -->
                                    <!-- import contracts -->
                                    <!-- ko foreach: $data.imports -->
                                    <tr>
                                        <td>
                                            <div class="input-group spinner input-transfer-amount">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <img class="icon-sm icon-light" src="../icons/icon_transporter_unloading_light.png" />
                                                        <a href="#" data-bind="click: () => {$root.selectedFactory($data.exportFactory)}, attr: {title: $data.exportFactory.name()}" style="margin: 0 0.25rem;">
                                                            <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.exportFactory.icon ? $data.exportFactory.icon : null, alt: $data.exportFactory.name}">
                                                        </a>
                                                    </span>
                                                    <span data-bind="if: $root.settings.missingBuildingsHighlight.checked() && $data.exportFactory.overProduction() < -ACCURACY">
                                                        <span class="fa fa-exclamation-triangle danger-icon"></span>
                                                    </span>
                                                </div>
                                                <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: exportAmount, attr: {id: $data.exportFactory.guid + '-import-contract-export-amount-input' } " />
                                                <div class="input-group-append">
                                                    <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.exportAmount, id: $data.exportFactory.guid + '-import-contract-export-amount-input' }}"></div>
                                                    <span class="input-group-text">t/min</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td><span>&rarr;</span></td>
                                        <td>
                                            <div class="float-right" data-bind="if: $parent.factory.overProduction() < -ACCURACY">
                                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.importDeficit.name}">
                                                    <span data-bind="text: formatNumber($parent.factory.overProduction())"></span>
                                                    <button class="btn btn-light btn-sm" data-bind="click: () => $data.importAmount($data.importAmount() - $parent.factory.overProduction())">
                                                        <span class="fa fa-sign-in"> </span>
                                                    </button>
                                                </div>
                                            </div>
                                        </td>
                                        <td>

                                            <div class="input-group spinner float-right input-transfer-amount">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">
                                                        <img class="icon-sm icon-light" src="../icons/icon_transporter_loading_light.png" />
                                                        <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.importFactory.icon ? $data.importFactory.icon : null, alt: $data.importFactory.name}" style="margin: 0 0.25rem;">
                                                    </span>
                                                </div>
                                                <input step="0.1" min="0" class="form-control" type="number" value="0" data-bind="value: importAmount, attr: {id: $data.exportFactory.guid + '-import-contract-import-amount-input' } " />
                                                <div class="input-group-append">
                                                    <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.importAmount, id: $data.exportFactory.guid + '-import-contract-import-amount-input' }}"></div>
                                                    <span class="input-group-text">t/min</span>
                                                </div>
                                            </div>

                                        </td>
                                        <td>

                                            <button class="btn btn-secondary btn-sm float-right" data-bind="click: () => $data.delete()">
                                                <span class="fa fa-trash"> </span>
                                            </button>

                                        </td>
                                    </tr>
                                    <!-- /ko -->
                                </tbody>
                            </table>
                        </div>

                        <!-- create new contracts -->
                        <form class="form form-inline" style="justify-content: space-between" data-bind="with: $root.contractCreatorFactory, visible: $root.contractCreatorFactory.canImport() || $root.contractCreatorFactory.canExport()">

                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">
                                        <img class="icon-sm icon-light" src="../icons/icon_transporter_unloading_light.png" data-bind="visible: !$data.export()" />
                                        <img class="icon-sm icon-light" src="../icons/icon_transporter_loading_light.png" data-bind="visible: $data.export()" />
                                    </span>
                                </div>
                                <select name="products" class="custom-select" id="contract-product" data-bind="value: $data.exchangeProduct, options: $data.exchangeProducts, optionsText: i => i.name()"></select>
                                <select name="factories" class="custom-select" id="contract-factory" data-bind="value: $data.exchangeFactory, options: $data.exchangeFactories, optionsText: i => i.getRegionExtendedName(), visible: $data.exchangeFactories().length > 1"></select>
                            </div>


                            <div>
                                <span data-bind="visible: $data.export()">&larr;</span>
                                <span data-bind="visible: !$data.export()">&rarr;</span>
                            </div>
                            <div style="display: flex">

                                <div class="mr-2" data-bind="visible: $data.canImport()">

                                    <img class="icon-sm icon-light" src="../icons/icon_transporter_loading_light.png" />
                                </div>

                                <div class="custom-control custom-switch" data-bind="visible: $data.canImport() && $data.canExport()">
                                    <input type="checkbox" class="custom-control-input" id="create-contract-export-checkbox" data-bind="checked: $data.export">
                                    <label class="custom-control-label" for="create-contract-export-checkbox" data-bind="visible: $data.canExport()">

                                        <img class="icon-sm icon-light" src="../icons/icon_transporter_unloading_light.png" />
                                    </label>
                                </div>

                                <div class="mr-2" data-bind="visible: !$data.canImport() && $data.canExport()">

                                    <img class="icon-sm icon-light" src="../icons/icon_transporter_unloading_light.png" />
                                </div>
                            </div>
                            <div class="input-group input-group-short spinner input-transfer-amount">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">
                                        <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $root.selectedFactory().icon ? $root.selectedFactory().icon : null, alt:$root.selectedFactory().name}" style="margin: 0 0.25rem;">
                                    </span>
                                </div>
                                <input step="0.1" class="form-control" type="number" value="0" data-bind="value: newAmount, attr: {id: 'factory-new-contract-amount-input' }" />
                                <div class="input-group-append">
                                    <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.newAmount, id: 'factory-new-contract-amount-input' }}"></div>
                                    <span class="input-group-text">t/min</span>
                                </div>
                            </div>

                            <button class="btn btn-sm btn-light" data-bind="click: () => $data.create(), enable: $data.canCreate()">
                                <span class="fa fa-plus"></span>
                            </button>
                        </form>

                        <hr />
                    </div>
                </div>

                <div data-bind="if: !$root.settings.simpleView.checked() && $data.isFactory && ($root.settings.additionalProduction.checked() || $root.settings.tradeRoutes.checked() || $data.contractList && $root.dlcsMap.get('dlc7').checked())">
                    <div class="inline-list-stretched" style="padding: .75rem;">
                        <div data-bind="if: $root.settings.tradeRoutes.checked()">
                            <span class="mr-3" data-bind="text: $root.settings.tradeRoutes.name"></span>
                            <span data-bind="text: formatNumber(-$data.tradeList.amount())"></span>
                            <span class="mr-3"> t/min</span>
                        </div>
                        <div data-bind="if: $data.contractList && $root.dlcsMap.get('dlc7').checked()">
                            <span class="mr-3" data-bind="text: $root.texts.docklands.name"></span>
                            <span data-bind="text: formatNumber(-$data.contractList.amount())"></span>
                            <span class="mr-3"> t/min</span>
                        </div>
                        <div data-bind="if: $root.settings.additionalProduction.checked()">
                            <span class="custom-control custom-checkbox" style="display:unset">
                                <input type="checkbox" class="custom-control-input" data-bind="checked: $data.extraGoodProductionList.checked, attr: { id: $data.guid + '-extraGoodProductionList-checked' }">
                                <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-extraGoodProductionList-checked' }, text: $root.texts.extraGoods.name" src-only style="vertical-align: top;">

                                </label>
                            </span>
                            <span data-bind="text: formatNumber($data.extraGoodProductionList.amountWithSelf())"></span>
                            <span class="mr-3"> t/min</span>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-light" data-bind="click: () => $data.updateExtraGoods(1), enable: $data.amount() || $data.extraGoodProductionList.amount() || $data.tradeList.amount() || $data.contractList && $data.contractList.amount()">
                                <span data-bind="text: $root.texts.apply.name">Apply</span>
                            </button>
                        </div>
                    </div>
                </div>
                <table class="table table-striped">
                    <tbody>
                        <tr data-bind="if: !$root.settings.simpleView.checked() && $data.isFactory && ($root.settings.additionalProduction.checked() || $root.settings.tradeRoutes.checked() || $data.contractList && $root.dlcsMap.get('dlc7').checked())">
                            <!-- extra goods -->
                            <td>
                                <span data-bind="text: $root.texts.extraNeed.name"></span>
                            </td>
                            <td>


                                <div class="float-right">
                                    <span data-bind="if: $data.extraAmount() < -ACCURACY + $data.computedExtraAmount()">
                                        <span class="fa fa-exclamation-triangle danger-icon"></span>
                                    </span>
                                    <div class="input-group input-group-short spinner">
                                        <input step="0.1" class="form-control" type="number" value="0" data-bind="value: extraAmount, attr: {id: $data.guid + '-extraAmount-input'} " />
                                        <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.extraAmount, id: $data.guid + '-extraAmount-input' }}"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-bind="if: $data.percentBoost">
                            <!-- boost -->
                            <td>
                                <span data-bind="text: $root.texts.productionBoost.name"></span>
                            </td>
                            <td>
                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.productionBoost.name}">
                                    <div class="input-group input-group-short spinner">
                                        <input class="form-control" type="number" value="100" step="1" min="1" data-bind="value: percentBoost, attr: {id: $data.guid + '-percentBoost-input'}" />
                                        <div class="input-group-append">
                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.percentBoost, id: $data.guid + '-percentBoost-input' }}"></div>
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr data-bind="with: $data.workforceDemand">
                            <!-- workforce -->
                            <td>
                                <span data-bind="text: $root.texts.workforce.name"></span>
                            </td>
                            <td>
                                <div class="inline-list-stretched">
                                    <div class="input-group input-group-short spinner">
                                        <input class="form-control" type="number" value="100" step="10" min="0" data-bind="value: percentBoost, attr: {id: $parent.guid + '-workforcePercentBoost-input'}" />
                                        <div class="input-group-append">
                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.percentBoost, id: $parent.guid + '-workforcePercentBoost-input' }}"></div>
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                    <div>

                                        <span data-bind="text: formatNumber($data.amount())"></span>
                                        <img class="mr-2 icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.workforce().icon ? $data.workforce().icon : null, alt: $data.workforce().name}">
                                    </div>
                                </div>

                            </td>
                        </tr>
                        <tr data-bind="if: $data.editable() || $root.settings.missingBuildingsHighlight.checked() && (!$data.region || !$data.island.region || $data.region === $data.island.region) ">
                            <!-- existing buildings -->
                            <td>
                                <span data-bind="text: $root.texts.existingNumberOfBuildings.name"></span>
                            </td>
                            <td>
                                <div href="#" data-toggle="tooltip" data-bind="attr: {'title' : $root.texts.existingNumberOfBuildings.name}">
                                    <div class="input-group input-group-short spinner">
                                        <input class="form-control" type="number" value="0" step="1" min="0" data-bind="value: existingBuildings, attr:{id: $data.guid + '-existingBuildings-input'}" />
                                        <div class="input-group-append">
                                            <div data-bind="component: { name: 'number-input-increment', params: { obs: $data.existingBuildings, id: $data.guid + '-existingBuildings-input' }}"></div>
                                        </div>
                                    </div>
                                </div>

                            </td>
                        </tr>

                        <tr data-bind="if: $root.settings.missingBuildingsHighlight.checked() && $data.overProduction">
                            <!-- overproduction -->
                            <td>
                                <span data-bind="text: $root.texts.overproduction.name"></span>
                            </td>
                            <td>
                                <div class="float-right">
                                    <span data-bind="text: formatNumber($data.overProduction())"></span><span> t/min</span>
                                </div>
                            </td>
                        </tr>

                        <tr data-bind="if: $data.palaceBuff && $data.palaceBuffChecked()">
                            <!-- extra goods palace -->
                            <td>
                                <span data-bind="text: $root.texts.extraGoods.name"></span>
                                <span>: </span>
                                <span data-bind="text: $data.palaceBuff.name"></span>
                            </td>
                            <td>
                                <div class="float-right">
                                    <img class="mr-2 icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name}">
                                    <span data-bind="text: formatNumber($data.buffAmount())"></span><span> t/min</span>
                                </div>
                            </td>
                        </tr>
                        <tr data-bind="if: $data.module && $data.moduleChecked()">
                            <!-- extra goods module -->
                            <td>
                                <span data-bind="text: $root.texts.extraGoods.name"></span>
                                <span>: </span>
                                <span data-bind="text: $data.module.name"></span>
                            </td>
                            <td>
                                <div class="float-right">
                                    <img class="mr-2 icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name}">
                                    <span data-bind="text: formatNumber($data.outputAmount() / $data.module.additionalOutputCycle)"></span><span> t/min</span>
                                </div>
                            </td>
                        </tr>
                        <tr data-bind="if: $data.module && $data.moduleChecked()">
                            <!-- consumption module -->
                            <td>
                                <span data-bind="text: $root.texts.consumption.name"></span>
                                <span>: </span>
                                <span data-bind="text: $data.module.name"></span>
                            </td>
                            <td>
                                <div class="float-right">
                                    <img class="mr-2 icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.moduleDemand.product.icon ? $data.moduleDemand.product.icon : null, alt: $data.moduleDemand.product.name}">
                                    <span data-bind="text: formatNumber($data.moduleDemand.amount())"></span><span> t/min</span>
                                </div>
                            </td>
                        </tr>
                        <tr data-bind="if: $data.fertilizerModule && $data.fertilizerModuleChecked()">
                            <!-- extra goods fertilizer fertilizerModule -->
                            <td>
                                <span data-bind="text: $root.texts.extraGoods.name"></span>
                                <span>: </span>
                                <span data-bind="text: $data.fertilizerModule.name"></span>
                            </td>
                            <td>
                                <div class="float-right">
                                    <img class="mr-2 icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name}">
                                    <span data-bind="text: formatNumber($data.outputAmount() / $data.fertilizerModule.additionalOutputCycle)"></span><span> t/min</span>
                                </div>
                            </td>
                        </tr>
                        <tr data-bind="if: $data.fertilizerModule && $data.fertilizerModuleChecked()">
                            <!-- consumption fertilizerModule -->
                            <td>
                                <span data-bind="text: $root.texts.consumption.name"></span>
                                <span>: </span>
                                <span data-bind="text: $data.fertilizerModule.name"></span>
                            </td>
                            <td>
                                <div class="float-right">
                                    <img class="mr-2 icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.fertilizerModuleDemand.product.icon ? $data.fertilizerModuleDemand.product.icon : null, alt: $data.fertilizerModuleDemand.product.name}">
                                    <span data-bind="text: formatNumber($data.fertilizerModuleDemand.amount())"></span><span> t/min</span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="ui-fchain-item-module" data-bind="visible: !$root.settings.simpleView.checked() && (!!$data.module || !!$data.palaceBuff || !!$data.clipped)">
                    <div style="flex: 100 1 auto;"></div>

                    <!-- module -->
                    <div data-bind="if: !!$data.module && $data.module.visible()" style="flex: auto;">
                        <div class="custom-control custom-checkbox" data-bind="visible: !!$data.module">
                            <input type="checkbox" class="custom-control-input" data-bind="checked: $data.moduleChecked, attr: { id: $data.guid + '-module' }">
                            <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-module', title: $data.module.name }" src-only style="vertical-align: top;">

                            </label>
                        </div>
                    </div>
                    <div data-bind="if: !!$data.module && $data.module.visible()" style="flex: auto;">
                        <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.module.icon ? $data.module.icon  : null, alt: $data.module.name, for: $data.guid + '-module', title: $data.module.name }" style="margin-right: 0.75em;margin-left: -0.25em;" />
                    </div>

                    <!-- fertilizerModule -->
                    <div data-bind="if: !!$data.fertilizerModule && $data.fertilizerModule.visible()" style="flex: auto;">
                        <div class="custom-control custom-checkbox" data-bind="visible: !!$data.fertilizerModule">
                            <input type="checkbox" class="custom-control-input" data-bind="checked: $data.fertilizerModuleChecked, attr: { id: $data.guid + '-fertilizerModule' }">
                            <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-fertilizerModule', title: $data.fertilizerModule.name }" src-only style="vertical-align: top;">

                            </label>
                        </div>
                    </div>
                    <div data-bind="if: !!$data.fertilizerModule && $data.fertilizerModule.visible()" style="flex: auto;">
                        <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.fertilizerModule.icon ? $data.fertilizerModule.icon  : null, alt: $data.fertilizerModule.name, for: $data.guid + '-fertilizerModule', title: $data.fertilizerModule.name }" style="margin-right: 0.75em;margin-left: -0.25em;" />
                    </div>

                    <!-- palace buff -->
                    <div data-bind="if: !!$data.palaceBuff && $data.palaceBuff.visible()" style="flex: auto;">
                        <div class="custom-control custom-checkbox" data-bind="visible: !!$data.palaceBuff">
                            <input type="checkbox" class="custom-control-input" data-bind="checked: $data.palaceBuffChecked, attr: { id: $data.guid + '-palaceBuff' }">
                            <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-palaceBuff', title: $data.palaceBuff.name }" src-only style="vertical-align: top;">

                            </label>
                        </div>
                    </div>
                    <div data-bind="if: !!$data.palaceBuff && $data.palaceBuff.visible()" style="flex: auto;">
                        <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.palaceBuff.icon ? $data.palaceBuff.icon  : null, alt: $data.palaceBuff.name, for: $data.guid + '-palaceBuff', title: $data.palaceBuff.name }" style="margin-right: 0.75em;margin-left: -0.25em;" />
                    </div>

                    <!-- clipping  -->
                    <div data-bind="if: !!$data.clipped" style="flex: auto;">
                        <div class="custom-control custom-checkbox" data-bind="visible: !!$data.clipped">
                            <input type="checkbox" class="custom-control-input" data-bind="checked: $data.clipped, attr: { id: $data.guid + '-clipped' }">
                            <label class="custom-control-label" data-bind="attr: { for: $data.guid + '-clipped', title: 'Clipping' }" src-only style="vertical-align: top;">
                                Clipping
                            </label>
                        </div>
                    </div>
                    <div style="flex: 100 1 auto;"></div>
                </div>

                <div data-bind="if: $data.isFactory && ($data.extraGoodProductionList.nonZero().length && $root.settings.additionalProduction.checked())">
                    <hr />

                    <h6><span data-bind="text: $root.texts.extraGoods.name">Extra Goods</span><span> </span><img src="../icons/icon_marketplace_2d_light.png" width="35" height="35" data-bind="attr: { src: $data.product.icon ? $data.product.icon : null, alt: $data.product.name}" /></h6>
                    <table class="table table-striped">
                        <tbody data-bind="foreach: $data.extraGoodProductionList.nonZero">
                            <tr>

                                <td>

                                    <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.item.item.icon ? $data.item.item.icon : null, alt: $data.item.name}"> <!-- item icon -->
                                    <img class="icon-sm" src="../icons/icon_marketplace_2d_light.png" data-bind="attr: { src: $data.factory.icon ? $data.factory.icon : null, alt: $data.factory.name}">

                                </td> <!-- factory icon -->
                                <td>
                                    <span data-bind="text: formatNumber($data.amount())"></span>
                                    <span> t/min</span>

                                </td>

                            </tr>
                        </tbody>
                    </table>


                </div>
                <div data-bind="if: $root.productionChain.tree() && $root.productionChain.tree().buildings > ACCURACY">
                    <hr />
                    <div class="tree" data-bind="with: $root.productionChain.tree()" style="justify-content: center">
                        <ul data-bind="template: 'treeElement'"></ul>
                    </div>
                </div>

                <div data-bind="component: { name: 'notes-section', params:{ $data: $data}}"></div>
            </div>
            <div class="modal-footer">
                <btn class="btn btn-light" data-bind="click: $data.applyConfigGlobally, visible: $root.islands().length > 1">
                    <span data-bind="text: $root.texts.applyGlobally.name()">Apply Globally</span>
                </btn>
            </div>
        </div>
    </div>
</div>